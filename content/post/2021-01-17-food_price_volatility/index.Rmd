---
title: "Volatilidade no Preços dos Alimentos - Jundiaí"
date: 2020-12-30
math: true
---

```{r, message=F, warning=F}
knitr::opts_chunk$set(
  message = F,
  warning = F,
  echo = F,
  eval = T,
  fig.align = "center"
)
```


Após muitas idas ao mercado, fiquei interessado em saber como os preços dos alimentos oscilam ao longo do tempo e em como eles se diferenciam de um mercado para outro (especificamente em Jundiaí). Por isso neste post vou analisar um dataset que eu mesmo atualizo, que mostra o preço dos alimentos que mais são usados em minha casa. 

Com este script, poderei apenas atualizar o post para pegar a última versão do dataset e acompanhar esta variação de preços. Vamos ver se conseguimos extrair algum insight ao final.

Para esta tarefa, vou usar os seguintes pacotes:

```{r}
library(tidyverse)
library(patchwork)

# Função para padronizar o design dos gráficos
theme_graph <- function(){
  theme(
    plot.title = element_text(size = 16),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(face = "italic", size = 9),
    axis.text = element_text(size = 9),
    axis.title = element_text(face = "italic", size = 9),
    strip.background = element_rect(fill = "grey"),
    strip.text = element_text(face = "bold"),
    legend.position = "bottom",
    legend.title = element_blank()
  )
}
```

O dataset está sendo atualizado em meu repositório do github. Se caso quiser acessá-lo pelo R, basta usar o comando abaixo:

```{r}
dataset <- readr::read_csv(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2020-06-20-grocery_price_volatility/dataset_1.csv")
```

Para este estudo, vou preferir olhar apenas para produtos que possuem mais que 3 observações, ou seja, que comprei mais que 3 vezes no período. O código abaixo irá listar os produtos que precisam ser removidos da análise.

```{r}
dataset %>%
  group_by(product) %>% 
  summarise(rows = n()) %>% 
  filter(rows <= 3) %>% 
  select(product) -> low_sample_product
```

Com esta lista de 'low_sample_product', podemos ajustar o dataset filtrando estes produtos.

```{r, warning=F, message=F}
dataset <- 
  dataset %>% 
  mutate(price_per_vol = price/volume_gm_ml) %>% 
  filter(!product %in% c(low_sample_product$product))
```

## ****

```{r, warning=F, message=F}
dataset$price <- as.numeric(dataset$price)

dataset %>% 
  group_by(product) %>% 
  summarise(rows = n()) %>% 
  mutate(product = fct_reorder(product, rows, .desc = T),
         product = fct_lump(product, 10)) %>% 
  ggplot2::ggplot()+
  geom_col(mapping = aes(x = product, y = rows))+
  coord_flip()
```

```{r, message=F, warning=F}
dataset %>%
  ggplot2::ggplot()+
  geom_line(mapping = aes(x = data, y = price_per_vol, group = local, color = local))+
  scale_color_brewer(type = "qual", palette = 2)+
  theme_graph()+
  facet_wrap(~product, scales = "free_y")
```

```{r, message=F, warning=F}
dataset %>% 
  ggplot2::ggplot()+
  geom_boxplot(mapping = aes(x = local, y = price_per_vol))+
  facet_wrap(~product, scales = "free_x")+
  coord_flip()
```






