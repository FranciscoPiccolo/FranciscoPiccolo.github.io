---
title: "World Bank database access throughout R"
date: 2019-11-30
output:
  html_document:
    df_print: paged
    fig_width: 8.5
    fig_height: 4
---

The World Bank was created in 1944 at the Bretton Woords Conferences and its goal is to fight poverty and inequality, throughout investments and support for developing countries. The institution's mission can be found on its [webpage](https://www.worldbank.org/en/who-we-are) and the first target seeing at the is reduce to 3% the share of people living on extreme poverty until 2030. When the World Bank was created, one of its first responsibilities was to support Europe's infrastructure reconstrution that had been devastated by the second world war [1](https://www.economist.com/the-economist-explains/2019/04/09/how-does-the-world-bank-work).

In order to reach its purpose, the institution relies on a huge database to support the development of research for countries in need of advise and investments. This database was built and it keeps being by the institution and it can be found [here](https://data.worldbank.org/indicator). Anyone can access this database, including R users, that can count with an API to access this database easier. The World Bank API is presented on the R package "wbstats" and this package will be the focus of this post.

To explore this package in this post, I'll analyse some indicators controlled by the World Bank. Just to note, this package was created by Jesse Piburn in 2018 january. The indicators that I'll analyse will be GDP, Gini, Debt and Trade. As well as "wbstats" package, I'll use other packages to execute the datamanipulation task.

```{r,eval=T,include=T,echo=T,warning=F,message=F}
library(wbstats)
library(tidyverse)
library(ggthemes)
library(ggalt)
library(scales)

theme_set(theme_bw())

theme_graph <- function(){
  theme(
    # background color
    panel.background = element_rect(fill = "white"),
    panel.grid.minor = element_blank(),
    plot.title = element_text(size = 16),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(face = "italic", size = 9),
    axis.text = element_text(size = 9),
    axis.title = element_text(face = "italic", size = 9),
    text = element_text(family = "Times New Roman"),
    strip.background = element_rect(fill = "grey"),
    strip.text = element_text(face = "bold"),
    legend.title = element_blank(),
    legend.position = "bottom"
  )
}
  
graph_color <- "#006666"
```

The "wb" function of the package seems to be the most important, it does the dowload of the data throughout the API e the output is a data.frame object. The main parameters of the function are: "indicator", "country", "startdate" and "enddate". The indicador is a code that can be found on the World Bank URL page, for example, if you wanna take GDP per capita indicator in 2010 dolar, the URL is (https://data.worldbank.org/indicator/NY.GDP.MKTP.KD?view=chart) and the code to insert on the "wb" function is **"NY.GDP.MKTP.KD"**. The country parameter can be one country in the iso2c format (e.g. "BR", "AF" or "US"), a region (e.g. "1A" = Arabic countries"), all countries and regions using "all" or just countries using "countries_only". Startdate and enddate parameters requires the data that you wanna the indicador, like from data > to date, and these two parameters can be replaced by the parameter "mrv" that means "most recent value" and this parameter will require an integer to indicate how many data points will be dowloaded (e.g. mrv = 5 means the 5 most recent values of the indicator).

Lets see some indicators of the institution to analyse how the database is organized. To start, I'll extract GDP per capita indicator at 2010 dolar values for the latim america region. In case you have some doubts about the country name, you can check at the indicator webpage.

```{r, eval = T, include = T, echo = T, warning = F, message = F}
# extracting the data and saving as a data.frame
df_gdp_pc <- wbstats::wb(indicator = "NY.GDP.PCAP.CD",
                         country = "all",
                         startdate = 1990,
                         enddate = 2010)

# filtering the required countries
df_gdp_pc %>% 
  select(country,value,date) %>% 
  filter(country %in% c("Brazil","Chile","Ecuador",
                        "Venezuela, RB","Colombia",
                        "Peru","Argentina","Bolivia",
                        "Uruguay","Paraguay")) %>% 
  arrange(date) %>% 
  head(10)
```

Having the data organized as a data.frame, lets see the GDP per capita of the selected countries between 1990 and 2010.

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gdp_pc %>% 
  select(country,value,date) %>% 
  filter(country %in% c("Brazil","Chile","Ecuador","Venezuela, RB"
                        ,"Colombia","Peru","Argentina"
                        ,"Bolivia","Uruguay","Paraguay")) %>% 
  filter(date %in% c("1990","2010")) %>% 
  mutate(country = fct_reorder(country,value)) %>% 
  ggplot(aes(x=country,y=value))+
  geom_col(fill="dark orange")+
  coord_flip()+
  theme_graph()+
  labs(title = "GDP per Capita",
       subtitle = "2010 US$ conversion",
       x = "",
       y = "")+
  facet_grid(~date)
```

As well as the GDP per capital, it's interesting to visualize the growth of this indicator. On the following graphs we'll verify which are the 30 countries that had the greatest variation of this indicator and also the 30 countries with the lowest variation, considering the same period of 1990 to 2010. For this analyse I've made a simple "case when" statement to classify the countries in groups of "low income", "middle income" and "high income".

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gdp_pc_2 <- wbstats::wb(indicator = "NY.GDP.PCAP.CD",
                           country = "countries_only",
                           startdate = 1990,
                           enddate = 2010)

df_gdp_pc_2 %>%
  select(date,
         country,
         value) %>% 
  filter(date %in% c("1990",max(date))) %>% 
  mutate(gdp_90 = ifelse(date == "1990",value,0),
         gdp_10 = ifelse(date == "2010",value,0)) %>% 
  group_by(country) %>% 
  summarise(gdp_90 = sum(gdp_90),
            gdp_10 = sum(gdp_10)) %>% 
  filter(gdp_90 > 0 & gdp_10 > 0) %>% 
  mutate(delta = round(1-(gdp_90/gdp_10),digits = 4),
         income_range = ifelse(gdp_10 <= 5000,"low",
                        ifelse(gdp_10 <= 15000,"middle",
                        ifelse(gdp_10 <= 45000,"up_middle",
                        ifelse(gdp_10 <= 60000,"high",
                        ifelse(gdp_10 <= 90000,"up_high",
                        "ultra_rich")))))) %>% 
  filter(income_range == "low") %>% 
  arrange(desc(delta)) %>% 
  head(20) %>% 
  ggplot()+
  ggalt::geom_dumbbell(aes(y = fct_reorder(country, gdp_10),
                           x = gdp_90,
                           xend = gdp_10),
  colour = "#3E39CD", size = 1,
  colour_x = "#BD274A", colour_xend = "#60AF1A")+
  scale_x_continuous(labels = scales::comma)+ # separando por vírgula ('000)
  theme_graph()+
  labs(title = "20 countries with the highest per capita GDP variation",
       subtitle = "Group: Low income (GDP per capita <= 5.000 US$ (2010))")
```

The preceding code can be replied, changing the filter "income_range == low", to middle, up_middle, high and up_high income.

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gdp_pc_2 %>%
  select(date,
         country,
         value) %>% 
  filter(date %in% c("1990",max(date))) %>% 
  mutate(gdp_90 = ifelse(date == "1990",value,0),
         gdp_10 = ifelse(date == "2010",value,0)) %>% 
  group_by(country) %>% 
  summarise(gdp_90 = sum(gdp_90),
            gdp_10 = sum(gdp_10)) %>% 
  filter(gdp_90 > 0 & gdp_10 > 0) %>% 
  mutate(delta = round(1-(gdp_90/gdp_10),digits = 4),
         income_range = ifelse(gdp_10 <= 5000,"low",
                        ifelse(gdp_10 <= 15000,"middle",
                        ifelse(gdp_10 <= 45000,"up_middle",
                        ifelse(gdp_10 <= 60000,"high",
                        ifelse(gdp_10 <= 90000,"up_high",
                        "ultra_rich")))))) %>% 
  filter(income_range == "middle") %>% 
  arrange(desc(delta)) %>% 
  head(20) %>% 
  ggplot()+
  ggalt::geom_dumbbell(aes(y = fct_reorder(country,gdp_10),
                           x = gdp_90,
                           xend = gdp_10),
  colour = "#3E39CD", size = 1,
  colour_x = "#BD274A", colour_xend = "#60AF1A")+
  scale_x_continuous(labels = comma)+ # separando por vírgula ('000)
  theme_graph()+
  labs(title = "20 countries with the highest per capita GDP variation",
       subtitle = "Group: Middle income (GDP per capita <= 15.000 US$ (2010))")
```

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gdp_pc_2 %>%
  select(date,
         country,
         value) %>% 
  filter(date %in% c("1990",max(date))) %>% 
  mutate(gdp_90 = ifelse(date == "1990",value,0),
         gdp_10 = ifelse(date == "2010",value,0)) %>% 
  group_by(country) %>% 
  summarise(gdp_90 = sum(gdp_90),
            gdp_10 = sum(gdp_10)) %>% 
  filter(gdp_90 > 0 & gdp_10 > 0) %>% 
  mutate(delta = round(1-(gdp_90/gdp_10),digits = 4),
         income_range = ifelse(gdp_10 <= 5000,"low",
                        ifelse(gdp_10 <= 15000,"middle",
                        ifelse(gdp_10 <= 45000,"up_middle",
                        ifelse(gdp_10 <= 60000,"high",
                        ifelse(gdp_10 <= 90000,"up_high",
                        "ultra_rich")))))) %>% 
  filter(income_range == "up_middle") %>% 
  arrange(desc(delta)) %>% 
  head(20) %>% 
  ggplot()+
  ggalt::geom_dumbbell(aes(y = fct_reorder(country,gdp_10),
                           x = gdp_90,
                           xend = gdp_10),
  colour = "#3E39CD", size = 1,
  colour_x = "#BD274A", colour_xend = "#60AF1A")+
  scale_x_continuous(labels = comma)+ # separando por vírgula ('000)
  theme_graph()+
  labs(title = "20 countries with the highest per capita GDP variation",
       subtitle = "Group: Up Middle income (GDP per capita <= 45.000 US$ (2010))")
```

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gdp_pc_2 %>%
  select(date,
         country,
         value) %>% 
  filter(date %in% c("1990",max(date))) %>% 
  mutate(gdp_90 = ifelse(date == "1990",value,0),
         gdp_10 = ifelse(date == "2010",value,0)) %>% 
  group_by(country) %>% 
  summarise(gdp_90 = sum(gdp_90),
            gdp_10 = sum(gdp_10)) %>% 
  filter(gdp_90 > 0 & gdp_10 > 0) %>% 
  mutate(delta = round(1-(gdp_90/gdp_10),digits = 4),
         income_range = ifelse(gdp_10 <= 5000,"low",
                        ifelse(gdp_10 <= 15000,"middle",
                        ifelse(gdp_10 <= 45000,"up_middle",
                        ifelse(gdp_10 <= 60000,"high",
                        ifelse(gdp_10 <= 90000,"up_high",
                        "ultra_rich")))))) %>% 
  filter(income_range == "high") %>% 
  arrange(desc(delta)) %>% 
  head(20) %>% 
  ggplot()+
  ggalt::geom_dumbbell(aes(y = fct_reorder(country,gdp_10),
                           x = gdp_90,
                           xend = gdp_10),
  colour = "#3E39CD", size = 1,
  colour_x = "#BD274A", colour_xend = "#60AF1A")+
  scale_x_continuous(labels = comma)+ # separando por vírgula ('000)
  theme_graph()+
  labs(title = "20 countries with the highest per capita GDP variation",
       subtitle = "Group: High (GDP per capita <= 60.000 US$ (2010))")
```

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gdp_pc_2 %>%
  select(date,
         country,
         value) %>% 
  filter(date %in% c("1990",max(date))) %>% 
  mutate(gdp_90 = ifelse(date == "1990",value,0),
         gdp_10 = ifelse(date == "2010",value,0)) %>% 
  group_by(country) %>% 
  summarise(gdp_90 = sum(gdp_90),
            gdp_10 = sum(gdp_10)) %>% 
  filter(gdp_90 > 0 & gdp_10 > 0) %>% 
  mutate(delta = round(1-(gdp_90/gdp_10),digits = 4),
         income_range = ifelse(gdp_10 <= 5000,"low",
                        ifelse(gdp_10 <= 15000,"middle",
                        ifelse(gdp_10 <= 45000,"up_middle",
                        ifelse(gdp_10 <= 60000,"high",
                        ifelse(gdp_10 <= 90000,"up_high",
                        "ultra_rich")))))) %>% 
  filter(income_range == "up_high") %>% 
  arrange(desc(delta)) %>% 
  head(20) %>% 
  ggplot()+
  ggalt::geom_dumbbell(aes(y = fct_reorder(country,gdp_10),
                           x = gdp_90,
                           xend = gdp_10),
  colour = "#3E39CD", size = 1,
  colour_x = "#BD274A", colour_xend = "#60AF1A")+
  scale_x_continuous(labels = comma)+ # separando por vírgula ('000)
  theme_graph()+
  labs(title = "20 countries with the highest per capita GDP variation",
       subtitle = "Group: Up High income (GDP per capita <= 90.000 US$ (2010))")
```

Now lets see, for the same country (i.e. Brazil), the variety of GDP indicators counted by the World Bank.

1. GDP per capita (PPP)

2. GDP per Capita (LCU - Local currency unit)

3. GDP per Capita (2010 US$)

4. GDP per Capita (current US$)

When you want bring more than one indicator, you just have to list then as a list. See the following code as an example:

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gdp_pc_3 <- wbstats::wb(indicator = c("NY.GDP.PCAP.PP.CD",
                                         "NY.GDP.PCAP.CN",
                                         "NY.GDP.PCAP.KD",
                                         "NY.GDP.PCAP.CD"),
                           country = "BRA",mrv = 10)
```

Lets plot a time series of these 4 indicators.

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gdp_pc_3 %>% 
  ggplot(aes(x=date,y=value,group=indicator,color=indicator))+
  geom_line(size=1)+
  geom_point()+
  scale_y_continuous(labels = scales::comma)+
  theme_graph()+
  labs(title = "Brazil GDP in 4 different visions",
       x = "",
       y = "")
```

Continuing with the analysis about economic indicators of the latin america region, lets see the government debt in proportion of the GDP. For this indicator, I'll bring the last 20 result set starting from the most recent, using the "mrv" parameter.

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gov_debt <- wbstats::wb(country = "countries_only",
                           indicator = "GC.DOD.TOTL.GD.ZS",
                           mrv = 20)
```

We can see which latin america country increased its spenditures in proportion of the GDP more. This can occur by an increase in spenditures or by a decrease in the GDP.

```{r, eval = T, include = T, echo = T, warning = F, message = F}
df_gov_debt %>% 
  filter(country %in% c("Brazil","Chile","Ecuador","Venezuela, RB",
                        "Colombia","Peru","Argentina","Bolivia",
                        "Uruguay","Paraguay")) %>% 
  select(country,
         date,
         value) %>% 
  mutate(country = factor(country,
                          levels = c( "Brazil",
                                      "Bolivia",
                                      "Colombia",
                                      "Uruguay",
                                      "Peru"))) %>% # reordenando os países
  ggplot(aes(x=date,y=value,group=country,color=country))+
  geom_line(size=1)+
  geom_point()+
  theme_graph()+
  labs(title = "Share of debt over GDP",
       subtitle = "",
       x = "",
       y = "")
```

Now lets see which latin america country have the greatest share of export and import over GDP. This indicator is interesting because it shows the comercial opennes of a country. We can note that Brazil and Argentina are the closest countries of the region.

```{r, eval = T, include = T, echo = T, warning = F, message = F}
wbstats::wb(indicator = "NE.TRD.GNFS.ZS",country = "countries_only") %>% 
  filter(country %in% c("Brazil","Chile","Ecuador","Venezuela, RB",
                        "Colombia","Peru","Argentina","Bolivia",
                        "Uruguay","Paraguay")) %>%
  select(country,
         date,
         value) %>% 
  mutate(country = fct_reorder(country,value,.desc = T)) %>% 
  ggplot(aes(x=date,y=value,group=country,color=country))+
  geom_line(size=1,alpha=.6)+
  geom_point()+
  scale_x_discrete(breaks = c(seq(1970,2020,by = 10)))+
  theme_graph()+
  labs(title = "% Exp + Imp over GDP",
       x = "",
       y = "")
```

And to finish, lets see the Gini index.

```{r, eval = T, include = T, echo = T, warning = F, message = F}
wbstats::wb(indicator = "SI.POV.GINI",country = "countries_only",mrv = 10) %>% 
  filter(country %in% c("Brazil","Chile","Ecuador","Venezuela, RB",
                        "Colombia","Peru","Argentina",
                        "Bolivia","Uruguay","Paraguay")) %>%
  select(country,
         date,
         value) %>% 
  mutate(country = fct_reorder(country,value,.desc = T)) %>% 
  ggplot(aes(x=date,y=value,group=country,color=country))+
  geom_line(size=1)+
  theme_graph()+
  labs(title = "Latin America Gini index",
       x = "",
       y = "")
```

That's it, I hope that with these examples shown it became possible to understand how the "wbstats" package works. I believe that this database can be pretty useful in a variety of projects.
