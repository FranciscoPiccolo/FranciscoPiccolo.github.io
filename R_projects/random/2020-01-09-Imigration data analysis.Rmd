---
title: ""
date: 2020-01-09
output:
  html_document:
    df_print: paged
    theme: cerulean
    highlight: zenburn
    fig_width: 8.5
    fig_height: 4
    code_folding: hide
---

Imigration is a central theme on political debates for presidential elections nowadays, creating a lot of controversies and also hope for many people. This social event is increasingly calling more attention, mainly after the Siria conflict and the weakness of the Venezuelan economy, perhaps it's because it surpreended politicians that didn't get ready earlier to obtain the benefits that migration flow can lead.

Because of this relevance about the theme, in November 2019 [The Economist](https://www.economist.com/printedition/2019-11-16) made a special report about imigration, with the goal of clarify the current situation and present success cases of countries that are obtaining advantages of the imigration flow. I really enjoyed the theme and the studies that was writen by the correspondents, and then I decided to write a post to present the mainly conclusions of the magazine and access the World Bank Database to explore the theme in depth and generate some insight.

Following is a picture of one of the articles presented in the magazine. This picture is awesome!

```{r pressure, echo=FALSE,fig.align='center', fig.cap="The Economist"}
knitr::include_graphics("C:/Users/francisco.piccolo/Desktop/R/franciscopiccolo.github.io/images/2020-01-09_imigration_post.png")
```

### Principais conclusões da reportagem {.tabset .tabset-fade .tabset.pills}

### Mainly conclusions of the report {.tabset ;tabset-fade; tabset.pills}

1) People that successfully migrate from a poor country to a rich one increase their income between 3 to 6 times, because the rich country has better institutions, capital alocation and modern companies.

2) If everone that which a country migraton was allowed to do it, thw world GDP could double.

3) Imigrants are more tended to open their own business, because they percept unatended demands easier and also they find alternative solutions to existent problems on the country that they enter.

4) The mainly "problem" with imigration is the cultural change, that occurs seedly in specific places, because imigrants tend to cluster in certain locals. This culturar change is the mainly problem with imigration and also the hardest to measure, thus it becomes difficult to be contested by people that favour imigration.

5) People are more tolerant to the imigration flow in their countries when the feel that their government are in charge of the frontier, in other words, with a efficient process that only allows the migration of people by the legal process.

6) Imigratns often share their wages with their families that have stayed on the country and this income fount is called [remitances](https://www.ted.com/talks/dilip_ratha_the_hidden_force_in_global_economics_sending_money_home). Remitances already is the mainly font of external investment in some poor countries. This flow of money has high potential of impacts, because it goes straight to the pocket of people that are in need and also this investment doesn't carry the risk of being misplaced by corruption. Remitances represent more than 10% of GDP of 28 countries currently (2019).

7) To obtain benefits from the imigration process, the government must be efficient on the integration of people on the labour market, in other to avoid the situation where the imigrant is demanding social care without being contributins to the tax revenue of the government.

### Theme's relevant data

Após entendermos um pouco mais sobre a imigração, podemos analisar alguns dados públicos para gerar insights novos sobre o tema. Irei utilizar a API do Banco Mundial que possui dados bem organizados sobre imigração nos países.

After we understand a little better of the imigration flow, we can analyse some public data in order to generate some new insights about this theme. For this activity, I'll utilize the World Banck Data API that contain organized data about imigration for almost every country. In this task I'll use the following packages:

```{r,eval=T,include=T,echo=T,warning=F,message=F}
library(wbstats)        # accessing the World Banck API
library(tidyverse)      # data science and data manipulation packages
library(ggthemes)       # themes for ggplot graphs
library(scales)         # adjusting axis scales
library(sqldf)          # SQL script inside R

# Tema do gráfico
theme_set(theme_bw())

# Parâmetros dos gráficos para facilitar a padronização
title_size <- 9
axis_size <- 8
graph_color <- "#509533"
```

#### Imigrants around the world

In this topic, we'll analyse how much imigrants the World Banck accounted in 2015 (the last period that the data was collected), as well the evolution of this population throughout the year and how much this population represents of the country that they leave. To collect the data, you just have to call the World Bank API using the following code:

```{r,eval=T,include=T,echo=T,warning=F,message=F}
migrants_pop <- wbstats::wb(indicator = "SM.POP.TOTL",
                              country = "countries_only",
                              startdate = 1980,
                              enddate = 2019)
```

**Imigrant population time series**

On the following graph, we can see that the number of imigrants has increased continuously throughout the years, but with peaks in specific periods, for exemple between 1985 and 1990 (probably there was a civil war in an African country). Syria's turmoil isn't presented on the data, since probably the effect on imigration flow started in 2016. It can be seeing that the accounted population as imigrants by the institution in 2015 is around 250 millions, beyond the Brazilian population.

```{r,eval=T,include=T,echo=T,warning=F,message=F}
migrants_pop %>% 
  group_by(date) %>% 
  summarise(total_migrants = sum(value)) %>% 
  ggplot(aes(x = date, y = total_migrants, group = 1))+
  geom_line(color = graph_color, size = 1)+
  scale_y_continuous(labels = scales::comma)+
  theme(
    axis.text.x = element_text(size = axis_size),
    title = element_text(size = title_size),
  )+
  labs(
    title = "Crescimento contínuo da população imigrante",
    caption = "Fonte: Banco Mundial",
    x = "",
    y = "Total de imigrantes"
  )
```

**Imigration participation on the local population**

On the following visualization, we'll see how much these people that imigrate represents on the country that they step in, considering 2015 and only countries with more than 10 million of people living in. Since this data set has too many countries (215), I'll select just 20 that have the greatest share of imigrants on their population. 

```{r,eval=T,include=T,echo=T,warning=F,message=F}
# Coletando dados da população do país
population <- wbstats::wb(indicator = "SP.POP.TOTL",
                          country = "countries_only")

population_2015 <- population %>% 
  filter(date == "2015") %>% 
  mutate(population = value) %>% 
  select(country,population)
```
```{r,eval=T,include=T,echo=T,warning=F,message=F}
# Fazendo o join com o data set de imigrantes
migrants_pop %>% 
  filter(date == "2015") %>% 
  select(country,value) %>% 
  inner_join(population_2015,by = c("country" = "country")) %>% 
  mutate(share_over_population = round(value/population,digits = 4)) %>% 
  filter(population >= 10000000) %>% 
  arrange(desc(share_over_population)) %>% 
  head(20) %>% 
  mutate(country = fct_reorder(country,share_over_population)) %>% 
  ggplot(aes(x = country, y = share_over_population))+
  geom_col(fill = graph_color)+
  scale_y_continuous(labels = scales::percent)+
  labs(
    title = "County rank by imigration share over population",
    x = "",
    y = "% of imigrants over the population"
  )+
  coord_flip()
```

#### Countries that lost more people during the last years

In the following analysis, I'll use an indicator of the World Bank that shows the net output of people from a country (i.e. imigration less migration) in a given year. In this analysis, I'll take the data from 2010 to 2017 (the last year of the collect), make the sum of this indicator (net_output) and then filter the countries that have the sum below 0, that will be the countries that had lost people in the considered period. Finnaly, I'll classify the remaining countries to take the first 20 with more people leaving the country.

```{r,eval=T,include=T,echo=T,warning=F,message=F}
net_migration <- wbstats::wb(indicator = "SM.POP.NETM",
                         country = "countries_only",
                         startdate = 2010,
                         enddate = 2019) %>% 
  filter(date > "2000") %>% 
  select(country,value,date)

# Selecionando os países que tiveram saída de pessoas no período
net_migration %>% 
  group_by(country) %>% 
  summarise(
    total_net_migration = sum(value)
  ) %>% 
  filter(total_net_migration < 0) %>% 
  select(country,total_net_migration) %>% 
  arrange(total_net_migration) %>% 
  head(20) -> country_with_neg_net_migration

net_migration %>% 
  inner_join(country_with_neg_net_migration, by = c("country" = "country")) %>% 
  group_by(country) %>% 
  summarise(net_migration = sum(value)) %>% 
  mutate(country = fct_reorder(country,net_migration,.desc = T)) %>% 
  ggplot(aes(x = country, y = net_migration))+
  geom_col(fill = graph_color)+
  scale_y_continuous(labels = scales::comma)+
  coord_flip()+
  theme(
    legend.position = "none",
    legend.title = element_blank()
  )+
  labs(
    title = "Countries with the greatest output of people from their country",
    subtitle = "Net output",
    x = "",
    y = "Net migration",
    caption = "From 2010 until 2017"
  )
```

The net output is interesting but the relative net output (%) can bring more clarity to the problem the country is facing. Índice, China and Bangladesh obviously are in the preceding graph because they have large population. On the following visualization I'll re do the preceding graph, however I'll sellect the countries considering the net output relative to the population. 

```{r,eval=T,include=T,echo=T,warning=F,message=F}
net_migration %>% 
  group_by(country) %>% 
  summarise(
    total_net_migration = sum(value)
  ) %>% 
  filter(total_net_migration < 0) %>% 
  select(country,total_net_migration) %>% 
  inner_join(population %>% 
  filter(date == "2018",
         value > 5000000) %>% 
  mutate(population = value) %>% 
  select(country,population),by = c("country" = "country")) %>% 
  mutate(share_over_population = round(total_net_migration/population,digits = 4)) %>% 
  arrange(share_over_population) %>% 
  head(20) %>%
  mutate(country = fct_reorder(country,share_over_population,.desc = T)) %>% 
  ggplot(aes(x = country, y = share_over_population))+
  geom_col(fill = graph_color)+
  scale_y_continuous(labels = scales::percent)+
  labs(
    title = "Share of population leaving the country",
    x = "",
    y = ""
  )+
  coord_flip()
```

As this indicator has more recent data, Syria is presented with its outflow well represented on the graph, because its civil war that is occuring since 2012. Venezuela also is well represented because of its economic crisis.

#### Remitances sent to the countries

Remitances, as showed on the articles, are the monetary values sent by people that migrated to their families that stayed on the country. Let's see how much this investment represents on the country's GDP. According with one of the articles from the Magazine, 28 countries have a share o remitances greater than 10% of their GDP. The World Bank data presents 29 countries with this mark. The following code show this output:

```{r,include=T,echo=T,warning=F,message=F}
remitances_over_gdp <- wbstats::wb(indicator = "BX.TRF.PWKR.DT.GD.ZS",
                         country = "countries_only")

remitances_over_gdp %>% 
  filter(date == "2018",
         country != "Lesotho",
         value > 10) %>%
  mutate(remitance_over_gdp = paste(round(value,digits = 0),"%",sep = "")) %>% 
  arrange(desc(value)) %>% 
  select(date,country,remitance_over_gdp)
```

Além do valor de remitances sobre o PIB, acho importante analisar se este fluxo de capital é acíclico (algo que foi comentado em uma das reportagens da The Economist), ou seja, se a remitance enviada possui correlação inversa com a variação do PIB (ou PIB per capita). A hipótese é de que a pessoa envie mais dinheiro caso a situação no país em que seus familiares estão piore.

Para analisar esta hipótese, vou selecionar alguns países e plotar uma série temporal para o PIB per capita e outra série temporal para o valor de remitances enviado ao país, também per capita. Os países selecionados para o teste foram: Yemen, Tanzania, Uganda, Tunisia, Chad, Syria, Suriname, Somalia, Serra Leoa, Senegal, Sudão, Rwanda, Nepal, Nigeria, Malawi, Mali, Libya, Kenya, Etiópia, Eritrea, Congo.

As well as the remitances share over GDP, it's important to see if this capital inflow is acyclic (an assumption commented in one of the articles of the special report). This characteristic indicates that the flow isn't correlated with the GDP variation (or GDP per capita variation). The hipothesis is that the persons that send they money, will send more when the economic situation on his/her familiy cuntry deteriorate. To validate this hipothesis I'll select some countries and plot a temporal serie for the GDP per capita and another temporal serie for the remitances per capita sent to the selected countries. The selected countries are: Suriname, Somalia, Sierra Leone, Senegal, Sudan, Rwanda, Nepal, Niger, Malawy, Mali, Lybia, Kenya, Ethiopia, Eritrea and Congo. 

```{r,include=F,echo=F,warning=F,message=F}
country_view <- c("Yemen, Rep.","Tanzania","Uganda",
                  "Tunisia","Chad","Syrian Arab Republic",
                  "	Suriname","Somalia","Sierra Leone",
                  "Senegal","Sudan","Rwanda","Nepal",
                  "Nigeria","Malawi","Mali","Libya",
                  "Kenya","Ethiopia","Eritrea",
                  "Congo, Rep.")
```

Collecting the neeeded indicators for this analysis:

```{r,include=F,echo=T,warning=F,message=F}
# Coletando os dados de Remitances enviadas e PIB per capita
remitances_received <- wbstats::wb(indicator = "BX.TRF.PWKR.CD.DT",
                               country = "countries_only")


gdp_pc <- wbstats::wb(indicator = "NY.GDP.PCAP.CD",
                      country = "countries_only")

```

Agora vamos verificar como se comportam as duas variáveis ao longo dos anos (a partir de 2010). Para criar o indicador de 'Remitances per Capita', eu trouxe os dados de população e fiz o join com os dados de remitances recebidas pelos países selecionados. Em seguida, fiz a divisão (remitances_received / population).

Now lets investigate how the two variables perform throughout the years (since 2010). In order to create the 'remitances per capita' indicator, I brought the population data and made a join with the remitances data. Next, I made de division (remitances received/population).

```{r,include=T,echo=T,warning=F,message=F}
remitances_received %>% 
  mutate(remitances_received = value) %>% 
  select(date,country,remitances_received) %>% 
  filter(country %in% country_view,
         date > 2010) %>% 
  inner_join(population %>% mutate(population = value) %>% 
               select(date,
                      country,
                      population), by = c("date" = "date", "country" = "country")) %>% 
  mutate(remitance_pc = round(remitances_received/population,digits = 4)) %>% 
  group_by(date) %>%
  summarise(remitances_received_pc = sum(remitance_pc)) %>% 
  ggplot(aes(x = date, y = remitances_received_pc, group = 1))+
  geom_line(color = graph_color, size = 1)+
  scale_y_continuous(labels = scales::comma)+
  theme(
    axis.text.x = element_text(size = 8, angle = 90),
    legend.title = element_blank(),
    legend.position = "right"
  )+
  labs(
    title = "Remitances per capita (US$)",
    subtitle = "Growth on the analysed period",
    x = "",
    y = ""
  )
```

```{r,include=T,echo=T,warning=F,message=F}
gdp_pc %>% 
  mutate(gdp_pc = value) %>% 
  select(date,country,gdp_pc) %>% 
  group_by(date) %>% 
  summarise(gdp_pc = sum(gdp_pc)) %>% 
  inner_join(remitances_received %>% select(date,country), by = c("date" = "date")) %>% 
  filter(country %in% country_view,
         date > 2010) %>% 
  ggplot(aes(x = date, y = gdp_pc, group = 1))+
  geom_line(color = graph_color, size = 1)+
  scale_y_continuous(labels = scales::comma)+
  theme(
    axis.text.x = element_text(size = 8, angle = 90),
    legend.title = element_blank(),
    legend.position = "right"
  )+
  labs(
    title = "GDP per capita (US$)",
    subtitle = "Drop on the analysed period",
    x = "",
    y = ""
  )
```

It's possible to afirm that this money inflow, sent by imigrants to their families that stay on the country, is acyclic and probably support a lot the poorest that are in need. 

#### Conclusions

Although the simplicity of these analysed, it was possible to validate the statistics of the magazine reports and generate some insights beyone that. Hope you have enjoyed.



