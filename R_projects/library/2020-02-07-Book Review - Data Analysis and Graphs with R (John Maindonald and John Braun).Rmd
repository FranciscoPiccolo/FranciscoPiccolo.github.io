---
title: ""
date: 2020-02-07
output:
  html_document:
    df_print: paged
    theme: cerulean
    highlight: zenburn
    fig_width: 8.5
    fig_height: 4
    code_folding: hide
---

```{r,echo=F,include=F,warning=F,message=F}
library(tidyverse)
library(DAAG)
library(Amelia)
library(ggthemes)

theme_set(theme_minimal())

# Parâmetros dos gráficos para facilitar a padronização
title_size <- 9
axis_size <- 8
graph_color <- "#509533"
```

### Resumo e exercícios respondidos {.tabset .tabset-fade .tabset-pills}

**Considerações gerais**

Este livro faz parte de uma coleção da Universidade de Cambridge - *Cambridge Series in Statistics and Probabilistic Mathematics*, onde além desta públicação, constam outros 19 livros que exploram áreas da estatística. 

O livro foi publicado (2ª ed) em 2006 e talvez seja por isso que os gráficos não façam uso da biblioteca ggplot e a manipulação dos dados não utilize dplyr ou algo do universo tidyverse. 

A didática do livro é muito boa, os autores conseguiram explicar os conceitos estatísticos com clareza e os códigos usados foram bem comentados para facilitar o entendimento. Para a aplicação dos exemplos e resolução dos exercícios, foram usadas bibliotecas que contêm os data sets necessários para cada situação, o que facilitou bastante, pois não foi preciso copiar a tabela do livro e salvar em um arquivo para depois importar para o R.

O que senti falta foi da resolução dos exercícios propostos. Por mais que haja exemplos ao longo do capítulo, na hora da resolução do exercício a pessoa pode se deparar com outro cenário não explorado nos exemplos.

Após 2 meses (sem muita pressa), consegui finalizar este livro. Alguns capítulos estavam em um (ou vários) patamares acima do meu nível de conhecimento, por isso não consegui absorver o conteúdo o suficiente para comentar sobre estes capítulos. Por isso, neste post vou falar resumidamente sobre os capítulos que consegui entender, colocar os exercícios que resolvi e comentar sobre os data sets utilizados.

```{r pressure, echo=FALSE,fig.align='center',fig.cap="Capa do livro"}
knitr::include_graphics("C:/Users/francisco.piccolo/Desktop/R/franciscopiccolo.github.io/images/2020-02-07_data analysis with R.png")
```

#### **Capítulo 1 - A brief introduction to R**

##### **Resumo**

Este capítulo trata de alguns conceitos básicos sobre a ferramenta R. O objetivo é apresentar ao leitor a ferramenta que será usada ao longo do livro para que ele se sinta a vontade em utilizá-la também. É tratado sobre os tipos de dados (e.g. factors, vectors, data.frames, list e strings), a forma de se plotar gráficos, instalar a chamar pacotes, pedir ajuda no sistema (via help) e construir funções. É falado também sobre alguns aspectos básicos de bons gráficos e como se realizar importação de arquivos para o R.

##### **Exercícios**

3) Aplique a função str() no data set *possum* do pacote DAAG e verifique se há valores nulos presentes.

```{r, echo=T, include=T, message=F,warning=F}
DAAG::possum %>% str()
```

```{r, echo=T, include=T, message=F,warning=F}
DAAG::possum %>% Amelia::missmap(main = "Valores nulos vs não nulos")
```

4) Verifique no data set *ais* do pacote DAAG se há desequilíbrio entre homens e mulheres nos esportes analisados.

```{r, echo=T, include=T, message=F,warning=F}
DAAG::ais %>% 
  group_by(sport,
         sex) %>% 
  summarise(qty = n()) %>% 
  tidyr::spread(sex,qty,fill = 0) %>% 
  mutate(m_proportion = round(m/(f+m),digits = 2)) %>% 
  ggplot(aes(x = sport, y = m_proportion))+
  geom_col(fill = graph_color)+
  scale_y_continuous(labels = scales::percent)+
  theme(
    title = element_text(title_size)
  )+
  labs(
    title = "Desequilíbrio entre os esportes analisados",
    x = "",
    y = "Male % participation"
  )+
  coord_flip()
```

5) Verifique no data set *rainforest* os valores nulos.

```{r, echo=T, include=T, message=F,warning=F}
DAAG::rainforest %>% 
  Amelia::missmap(main = "Valores nulos vs não nulos")
```

#### **Capítulo 2 - Styles of data analysis**

##### **Resumo**

Este capítulo irá focar em princípios para se realizar uma análise exploratória dos dados através de gráficos. O livro apresenta uma conceituação para o termo 'Análise exploratória de dados' dizendo que é o nome para uma coleção de técnicas de apresentação de dados que objetivam fazer com que os dados falem por si só. O nome foi criado por John W. Tukey, que foi um grande influenciador desta área de estudo. 

Neste capítulo, são explorados os principais gráficos que são usados na atividade de análise exploratória, sendo eles o histograma (para validação de normalidade), o box plot e o gráfico de dispersão. A ideia é apresentar técnicas que permitam o pesquisador / analista encontrar padrões nos dados para que se possa desenvolver um modelo estatístico em seguida.

Neste capítulo também é tratado sobre outliers e dados distribuídos de maneira não normal (e.g. com caldas alongadas ) e como lidar com estes dados, seja retirando os outliers e realizando transformação em log para normalizar a distribuição.

##### **Exercícios**

1) Apresente a distribuição de idade para cada combinação de *site* e *sex* do data set *possum* do pacote DAAG.

```{r, echo=T, include=T, message=F,warning=F}
DAAG::possum %>%
  ggplot(aes(x = age))+
  geom_density(fill = "#00AFBB", alpha = .5)+
  theme(
    axis.text.y = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )+
  labs(
    title = "Age distribution",
    subtitle = "Site and Sex segmentation",
    x = "Age",
    y = ""
  )+
  facet_grid(site~sex,scales = "free")
```

3) Plote um histograma para o campo *earchonch* do data set *possum*. A distribuição deverá parecer bimodal (dois picos). Este é um exemplo de clusterização dos dados, neste caso por conta de que o data set contém informação de homens e mulheres. Plote um gráfico de box plot para homens e mulheres para o campo *earconch*.

```{r, echo=T, include=T, message=F,warning=F}
DAAG::possum %>% 
  ggplot(aes(x = earconch))+
  geom_density(fill = graph_color, alpha = .4)+
  labs(
    title = "Earconch distribution",
    x = "",
    y = ""
  )

DAAG::possum %>% 
  ggplot(aes(y = earconch, fill = sex))+
  geom_boxplot()+
  theme(legend.title = element_blank(),
        legend.position = "top")+
  labs(
    title = "Earconch box plot distribution",
    x = "",
    y = ""
  )
```

4) Usando o data set *ais* do pacote DAAG, crie gráficos que mostre como os valores de medidas hematológicas (quantidade de células vermelhas, concentração de hemoglobina, hematrócito, células brancas e concentração de plasma) variam por esporte e gênero do atleta.

```{r, echo=T, include=T, message=F,warning=F}
DAAG::ais %>% 
  mutate(red_cell_count = rcc,
         white_cell_count = wcc,
         hematrocit_percent = hc,
         hemaglobin_concentration = hg,
         plasma_ferritins = ferr,
         body_mass_index = bmi
  ) %>% 
  select(sport,
         sex,
         red_cell_count,
         white_cell_count,
         hematrocit_percent,
         hemaglobin_concentration,
         plasma_ferritins,
         body_mass_index) %>%
  filter(sex == "m") %>% 
  tidyr::gather(key = "campo",value = "valor", 3:8) %>% 
  mutate(sport = fct_reorder(sport, valor, .desc = F)) %>% 
  ggplot(aes(y = valor, fill = sport))+
  geom_boxplot(alpha = .6)+
  theme(legend.title = element_blank(),
        legend.position = "top")+
  labs(
    title = "Metrics variations accross sport and genre",
    subtitle = "Genre = Male",
    x = "",
    y = ""
  )+
  facet_wrap(~campo,scales = "free")
```

```{r, echo=F, include=T, message=F,warning=F}
DAAG::ais %>% 
  mutate(red_cell_count = rcc,
         white_cell_count = wcc,
         hematrocit_percent = hc,
         hemaglobin_concentration = hg,
         plasma_ferritins = ferr,
         body_mass_index = bmi
  ) %>% 
  select(sport,
         sex,
         red_cell_count,
         white_cell_count,
         hematrocit_percent,
         hemaglobin_concentration,
         plasma_ferritins,
         body_mass_index) %>%
  filter(sex == "f") %>% 
  tidyr::gather(key = "campo",value = "valor", 3:8) %>% 
  mutate(sport = fct_reorder(sport, valor, .desc = F)) %>% 
  ggplot(aes(y = valor, fill = sport))+
  geom_boxplot(alpha = .6)+
  theme(legend.title = element_blank(),
        legend.position = "top")+
  labs(
    title = "Metrics variations accross sport and genre",
    subtitle = "Genre = Female",
    x = "",
    y = ""
  )+
  facet_wrap(~campo,scales = "free")
```

#### **Capítulo 3 - Statistical models**

##### **Resumo**

No capítulo 3, ocorre uma breve explicação sobre o que são e para que servem modelos estatísticos. Neste capítulo fala-se um pouco sobre os *resíduos*, escolhe de modelos, distribuições dos dados, por conta de serem um modelo para os valores populacionais de uma dada métrica (Bernoulli, Binomial, Poisson e Normal), utilização de números aleatórios na construção de modelos, técnicas de amostragem e principais premissas adotadas na construção de modelos (e.g. normalidade dos dados, amostragem aleatória). 

Para a premissa de normalidade dos dados, os autores indicam técnicas para validar isso. A principal é o histograma, porém devendo ser reforçada pelo qq-plot e também testes formais.

##### **Exercícios**

2) Use *y <- rnorm(100)* para gerar 100 números aleatórios de uma distribuição normal (mean = 0 e sd = 1). Calcule a média e o desvio padrão de y. Em seguida, crie um loop e repita esta função 25 vezes e depois insira as 25 médias em uma variável e depois calcule a média e o desvio padrão desta variável.

```{r, echo=T, include=T, message=F,warning=F}
y <- rnorm(100)

tibble(mean = mean(y),
           sd = sd(y))
```

```{r, echo=T, include=T, message=F,warning=F}
# Criando um vetor com 25 entradas vazias
saida <- rep(NA,25)

# Criando um loop para gerar no vetor vazio as 25 amostragens
for(i in 1:25){
  saida[i] <- data.frame(
    mean(rnorm(100))
  )
}

# Criando um data.frame com o resultado acima
df <- data.frame(
  a = matrix(unlist(saida),nrow = 25,byrow = F),stringsAsFactors = F)

tibble(mean = mean(df[,1]),
           sd = sd(df[,1]))
```

3) Crie uma função para gerar o resultado do exercício 2. Rode esta função várias vezes e plote o resultado em um gráfico de densidade.

```{r, echo=T, include=T, message=F,warning=F}
# Criando a função, x = repetições, y = amostras aleatórias
fun <- function(x,y){
  saida <- rep(NA,x)
  for(i in 1:x){
    saida[i] <- data.frame(
      round(mean(rnorm(y)),digits = 2)
    )
  }
  df <- data.frame(
    a = matrix(unlist(saida),nrow = x,byrow = T),stringsAsFactors = F)
}

# Rodando a função, 25 repetições com 100 amostras cada
fun(25,100) %>% 
  ggplot(aes(x = a))+
  geom_density(fill = graph_color, alpha = .4)
```



#### **Capítulo 4 - An introduction to formal inference**

#### **Capítulo 5 - Regression with a single predictor**

#### **Capítulo 6 - Multiple linear regression**

#### **Capítulo 7 - Exploiting the linear model framework**

#### **Capítulo 8 - Generalized linear models and survival analysis**

#### **Capítulo 9 - Time series models**

#### **Capítulo 10 - Multi level models and repeated measures**

#### **Capítulo 11 - Tree-based classification and regression**

#### **Capítulo 12 - Multivariate data exploration and discrimination**

#### **Capítulo 13 - Regression on principal component or discriminant scores**





