<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Francisco Piccolo ">
<meta name="description" content="IntroductionIn this tutorial I’ll show a step by step on how to access Amazon Redshift Database throughout R. This task will be very useful if you prefer use R intead of the traditional Excel to execute exploratory data analysis on your company. The goal of this tutorial is to access the database from R, bring a data.frame as a result set and then create your analysis.
Step 1Dowload the JDBC driver from Amazon." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<link rel="canonical" href="/posts/2019/10/connecting-r-on-amazon-redshift-database/" />


    <title>
        
            Connecting R on Amazon Redshift Database :: Glass Frog  — Hello Friend NG Theme
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.753fac8f03736f0edc9be411eb20cee875dd7bb8e73c8155fbf6a629c863f4ca.css">




    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">



<meta itemprop="name" content="Connecting R on Amazon Redshift Database">
<meta itemprop="description" content="IntroductionIn this tutorial I’ll show a step by step on how to access Amazon Redshift Database throughout R. This task will be very useful if you prefer use R intead of the traditional Excel to execute exploratory data analysis on your company. The goal of this tutorial is to access the database from R, bring a data.frame as a result set and then create your analysis.
Step 1Dowload the JDBC driver from Amazon.">
<meta itemprop="datePublished" content="2019-10-28T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-10-28T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="717">
<meta itemprop="image" content="/"/>



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="Connecting R on Amazon Redshift Database"/>
<meta name="twitter:description" content="IntroductionIn this tutorial I’ll show a step by step on how to access Amazon Redshift Database throughout R. This task will be very useful if you prefer use R intead of the traditional Excel to execute exploratory data analysis on your company. The goal of this tutorial is to access the database from R, bring a data.frame as a result set and then create your analysis.
Step 1Dowload the JDBC driver from Amazon."/>







    <meta property="article:published_time" content="2019-10-28 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">Home</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/books/">Book Review</a></li><li><a href="/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>4 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="/posts/2019/10/connecting-r-on-amazon-redshift-database/">Connecting R on Amazon Redshift Database</a>
            </h1>

            

            <div class="post-content">
                


<div id="introduction" class="section level2">
<h2><strong>Introduction</strong></h2>
<p>In this tutorial I’ll show a step by step on how to access Amazon Redshift Database throughout R. This task will be very useful if you prefer use R intead of the traditional Excel to execute exploratory data analysis on your company. The goal of this tutorial is to access the database from R, bring a data.frame as a result set and then create your analysis.</p>
</div>
<div id="step-1" class="section level2">
<h2><strong>Step 1</strong></h2>
<p>Dowload the JDBC driver from Amazon. This file will be needed to allow the connection of one tool (i.e. R Studio) to the Amazon cluster that you have access. In this <a href="https://docs.aws.amazon.com/pt_br/redshift/latest/mgmt/configure-jdbc-connection.html#obtain-jdbc-url">link</a> there’s the files indicated for each version of the JDBC.</p>
<p>Ps: If at the end of the role process the database access fail, take a look on the above file that you dowloaded to see if it came corrupted. This can be caused (not likely but it can) when the dowload is made directly from R.</p>
</div>
<div id="step-2" class="section level2">
<h2><strong>Step 2</strong></h2>
<p>Inside R Studio, install and call the following packages: “rJava” and “RJDBC”.</p>
<pre class="r"><code>install.packages(&quot;rJava&quot;)
install.packages(&quot;RJDBC&quot;)

library(rJava)
library(RJDBC)</code></pre>
</div>
<div id="step-3" class="section level2">
<h2><strong>Step 3</strong></h2>
<p>Create a variable (i.e. “driver”) that will contain the JDBC file that was dowloaded on the Step 1. Use the following code for this step:</p>
<pre class="r"><code>driver &lt;- JDBC(driverClass = &quot;com.amazon.redshift.jdbc41.Driver&quot;, 
               classPath = Sys.glob(&quot;caminho do arquivo/RedshiftJDBC41-1.1.9.1009.jar&quot;), 
               identifier.quote=&quot;`&quot;)</code></pre>
</div>
<div id="step-4" class="section level2">
<h2><strong>Step 4</strong></h2>
<p>Create a variable (i.e. “db_connection”) that will indicate the information of the database to be accessed by R Studio. Use the following code for this step:</p>
<pre class="r"><code>db_connection &lt;- sprintf(&quot;jdbc:redshift://%s:%s/%s?tcpKeepAlive=true&amp;ssl=true&amp;sslfactory=com.amazon.redshift.ssl.NonValidatingFactory&quot;, 
                         &quot;host of the database&quot;, 
                         &quot;port&quot;, 
                         &quot;database name&quot;)</code></pre>
</div>
<div id="step-5" class="section level2">
<h2><strong>Step 5</strong></h2>
<p>Create a variable (i.e. “access”) that will contain the information of the database and also the user that will access the database. Use the following code for this step:</p>
<pre class="r"><code>access &lt;- dbConnect(driver, db_end, &quot;user&quot;, &quot;password&quot;)</code></pre>
<p>Ps: Note that the funcion “dbConnect” used the database access file driver, the information of the database that will be accessed and the information of the user that will access the database.</p>
</div>
<div id="step-6" class="section level2">
<h2><strong>Step 6</strong></h2>
<p>After the creation of the necessary variables, to access the database it’ll be necessary the last one created (at step 5). To access the database, the package RJDBC will be used. Some examples can be seeing on the code chunck that follows:</p>
<p>Ps: Queries run on R Studio console must by with quotes.</p>
<pre class="r"><code>RJDBC::dbGetQuery(jconn,
                  &quot;select 
                     order
                   , client
                   , sale_date 
                  from orders_tb 
                  limit 10&quot;)

RJDBC::dbGetQuery(jconn,
                  &quot;select 
                     supplier
                   , invoice 
                  from supplier.tb 
                  where 1 = 1 
                  and delivery.date = 2019-01-30 
                  limit 10&quot;)</code></pre>
</div>
<div id="step-7" class="section level2">
<h2><strong>Step 7</strong></h2>
<p>To explore the feature in depth, it’s interesting that, intead of writing the query on the R Studio console, you save your query in a file (.sql) and make R access this file and save it as a variable (i.e. “sql_file”). To do this, it’s necessary to install and call the “readr” package.</p>
<pre class="r"><code>install.packages(&quot;readr&quot;)

library(readr)

-- Saving the .sql file as a variable
sql_file &lt;- readr::read_file(&quot;path_of_the_file/script.sql&quot;)

-- Using the .sql file to access Redshift database
query_redshift &lt;- RJDBC::dbGetQuery(jconn, sql_file)</code></pre>
</div>
<div id="final-step-plus" class="section level2">
<h2><strong>Final step (plus)</strong></h2>
<p>Sometimes you can have projects that demand more than one query, thus you will need many .sql files in order to run each query. But there’s a solution to make things simpler. You can save many queries on the same .sql file and separate each query by a string (i.e. –query_1_being, –query_1_end, –query_2_begin, –query_2_end, and so on). Then, you can use regexp to split your file and create variables for each query. The regexp will access the defined query and execute the split to create the variable with just one query code. For this step, you will need to install and call the “stringr” package.</p>
<pre class="r"><code>install.packages(&quot;stringr&quot;)

library(stringr)

-- saving the .sql file as a variable
sql_syntax &lt;- readr::read_file(&quot;.sql_file_path.all_queries.sql&quot;)

-- creating one variable with the first query of the .sql file
query_1 &lt;- 
  RJDBC::dbGetQuery(jconn, 
                    substr(sql_syntax, 
                           min(stringr::str_locate(string = sql_syntax, &#39;-- query.1.begin&#39;)), 
                           max(stringr::str_locate(string = sql_syntax, &#39;-- query.1.end&#39;))))

query_2 &lt;- 
  RJDBC::dbGetQuery(jconn, 
                    substr(sql_syntax, 
                           min(stringr::str_locate(string = sql_syntax, &#39;-- query.2.begin&#39;)), 
                           max(stringr::str_locate(string = sql_syntax, &#39;-- query.2.end&#39;))))

query_3 &lt;- 
  RJDBC::dbGetQuery(jconn, 
                    substr(sql_syntax, 
                           min(stringr::str_locate(string = sql_syntax, &#39;-- query.3.begin&#39;)),
                           max(stringr::str_locate(string = sql_syntax, &#39;-- query.3.end&#39;))))</code></pre>
</div>
<div id="conclusion" class="section level2">
<h2><strong>Conclusion</strong></h2>
<p>This tutorial was aimed to show how simple it is to access Amazon Redshift database throughout R Studio. It’s an excellent alternative when you want to perform robust exploratory data analysis (where Excel will let you down).</p>
</div>
<div id="more-tutorials-on-the-subject" class="section level2">
<h2><strong>More tutorials on the subject</strong></h2>
<p><a href="https://www.progress.com/tutorials/jdbc/connecting-to-amazon-redshift-from-r-via-jdbc-driver">Connecting to Amazon Redshift from R</a></p>
<p><a href="https://www.r-bloggers.com/a-comprehensive-guide-to-connect-r-to-amazon-redshift/">A comprehensive guide to connect R to Amazon Redshift</a></p>
</div>

            </div>
        </article>

        <hr />

        <div class="post-info">

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>717 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2019-10-27 21:00 -0300</p>
        </div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="/">Francisco Piccolo</a></span>
            
            <span></span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
    
    
    
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
        
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: true,
                processEnvironments: true
            },
            // Center justify equations in code and markdown cells. Elsewhere
            // we use CSS to left justify single line equations in code cells.
            displayAlign: 'center',
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}},
                linebreaks: { automatic: true }
            }
        });
        </script>
        

</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.4a69500057d68129e88f497d354afe68422eb56de6d15e45dbe2190858ea5a76bfcb096406f992984b241db45f47388ac57ab0376e3b32125bef7a8a6d0f06c4.js" integrity="sha512-SmlQAFfWgSnoj0l9NUr&#43;aEIutW3m0V5F2&#43;IZCFjqWna/ywlkBvmSmEskHbRfRziKxXqwN247MhJb73qKbQ8GxA=="></script>



    </body>
</html>
