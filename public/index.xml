<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Francisco Piccolo</title>
    <link>https://francisco.piccolo.com/</link>
      <atom:link href="https://francisco.piccolo.com/index.xml" rel="self" type="application/rss+xml" />
    <description>Francisco Piccolo</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>en-us</language><lastBuildDate>Tue, 10 Sep 2019 00:00:00 +0000</lastBuildDate>
    <image>
      <url>https://francisco.piccolo.com/images/icon_hu7930c23c34249c3e1231392b717ef0d2_2480_512x512_fill_lanczos_center_2.png</url>
      <title>Francisco Piccolo</title>
      <link>https://francisco.piccolo.com/</link>
    </image>
    
    <item>
      <title>Análise de Resíduos em Modelos de Regressão Linear</title>
      <link>https://francisco.piccolo.com/post/2019-09-05-residual-analysis-in-econometric-models/</link>
      <pubDate>Tue, 10 Sep 2019 00:00:00 +0000</pubDate>
      <guid>https://francisco.piccolo.com/post/2019-09-05-residual-analysis-in-econometric-models/</guid>
      <description>
&lt;script src=&#34;https://francisco.piccolo.com/post/2019-09-05-residual-analysis-in-econometric-models/
index.en_files/header-attrs/header-attrs.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;O modelo de regressão linear é bastante usado na predição de variáveis contínuas, onde há uma ou mais variáveis independentes buscando mapear o comportamento de uma variável dependente. O modelo é bastante simples e lembro ser um dos primeiros a ser ensinado nas aulas de econometria. Porém, apesar de sua simplicidade, é preciso se atentar a alguns detalhes sobre suas premissas para que os resultados deste modelo possam ser usados para a tomada de decisão.&lt;/p&gt;
&lt;p&gt;Abaixo vou listar algumas das premissas da regressão linear:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: lower-roman&#34;&gt;
&lt;li&gt;&lt;p&gt;Ausência de multicolinearidade entre as variáveis independentes.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Ausência de autocorrelação na variável dependente.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Absence of pattern on the behavior of the model residuals, in other words, absence of heteroscedasticity.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Ausência de padrão no comportamento dos resíduos do modelo, ou seja, ausência de heterocedasticidade.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Resíduos se distribuem de acordo com uma distribuição normal.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Tendo estas premissas atendidas, o modelo pode gerar conclusões confiáveis. Neste post eu vou desenvolver alguns modelos de regressão linear para testar as premissas &lt;strong&gt;iii&lt;/strong&gt; e &lt;strong&gt;iv&lt;/strong&gt; que tratam dos resíduos, para ver alguns casos práticos.&lt;/p&gt;
&lt;p&gt;Para começar, vamos trazer os pacotes necessários para execução das funções no R:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(tidyverse)
library(lmtest)
library(corrplot)
library(readxl)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Também vou criar uma função para facilitar a padronização dos gráficos que serão gerados.&lt;/p&gt;
&lt;div id=&#34;exemplo-1-elasticidade-preço-x-oferta-na-produção-de-cana-de-açúcar.&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Exemplo 1: Elasticidade preço x oferta na produção de cana de açúcar.&lt;/h4&gt;
&lt;p&gt;Este exemplo foi passado na minha aula de econometria em 2017. Na época o exercício foi realizado com o software &lt;strong&gt;EViews&lt;/strong&gt;, por sorte eu guardei os dados e agora posso refazer o problema com mais facilidade com o uso do R.&lt;/p&gt;
&lt;p&gt;No exercício, há a variável independente (X) sendo o preço da cana de açúcar e a variável dependente (Y) sendo a área plantada de cana de açúcar (representando uma proxy para a oferta do produto). O objetivo deste modelo é tentar quantificar a elasticidade da oferta em função do preço, ou seja, quantificar quão sensível é a oferta da cana de açúcar quando ocorre uma variações em seu preço. Os dados deste exercício estão no meu repositório do Github, vamos trazê-los com o comando abaixo, salvando-os na variável df (a.k.a data.frame):&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df &amp;lt;- read.csv(file = &amp;quot;https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2019-09-05-residual_analysis_on_linear_regression_models/dataset_1.csv&amp;quot;, sep = &amp;quot;;&amp;quot;, dec = &amp;quot;,&amp;quot;)

dim(df)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 34  3&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Com a função &lt;strong&gt;dim&lt;/strong&gt; podemos ver a dimensão deste dataset, com 34 registros e 3 colunas.&lt;/p&gt;
&lt;p&gt;The data set for this example has 34 rows, with planted area and suggarcane price fields. Vamos ver uma amostra dos dados.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df[sample(nrow(df),5), ] %&amp;gt;%
    as_tibble()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 5 x 3
##   period  area price
##    &amp;lt;int&amp;gt; &amp;lt;int&amp;gt; &amp;lt;dbl&amp;gt;
## 1     22   138 0.285
## 2     34   235 0.392
## 3     32   208 0.463
## 4     25    87 0.301
## 5      9    60 0.188&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O modelo de regressão linear para este cenário será desenvolvido de acordo com a fórmula abaixo:&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[ lnY_t = \beta_0+\beta_1 (lnX_t) + \mu_t \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Onde:&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(Y_t\)&lt;/span&gt; = Área plantada após a transformação com log natural (e)&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(X_t\)&lt;/span&gt; = Preço da cana de açúcar também após a transformação com log natural&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(\beta_0\)&lt;/span&gt; = Intercepto&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(\beta_1\)&lt;/span&gt; = Inclinação&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(\mu_t\)&lt;/span&gt; = Resíduos&lt;/p&gt;
&lt;p&gt;Os dados precisam ter a aplicação do log natural, pois esta transformação faz com que as variações entre os períodos possam ser interpretadas como variações percentuais, e isso é necessário por conta de que a elasticidade é quantificada em termos percentuais. Esta característica ocorre apenas na transformação com logarítmo natural, se a transformação fosse feita com outros logs, a interpretação não seria válida.&lt;/p&gt;
&lt;p&gt;O gráfico abaixo irá mostrar o comportamento das variáveis do dataset, bem como a curva de regressão linear, antes de aplicar a transformação log natural.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df %&amp;gt;% 
  ggplot()+
  geom_point(mapping = aes(x = price, y = area), shape = 2)+
  geom_smooth(mapping = aes(x = price, y = area), 
              method = &amp;quot;lm&amp;quot;, 
              formula = y ~ x, 
              se = F, 
              lty = 2,
              color = &amp;quot;dark orange&amp;quot;)+
  theme_graph()+
  labs(title = &amp;quot;Gráfico de dispersão das variáveis&amp;quot;,
       x = &amp;quot;Preço da Cana de Açúcar&amp;quot;,
       y = &amp;quot;Área Plantada&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://francisco.piccolo.com/post/2019-09-05-residual-analysis-in-econometric-models/
index.en_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;432&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Podemos ver que há uma relação entre o preço do produto e sua oferta. Agora vamos aplicar o log natural no modelo de regressão. Para isso, o R nos fornece duas opções:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Ajustar as variáveis no dataset e construir o modelo usando as variáveis ajustadas.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Construir o modelo e indicar “dentro dele” que é necessário fazer a transformação antes de computar os resultados.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Vamos ver na prática como cada opção pode ser usada. O resultado final será idêntico.&lt;/p&gt;
&lt;p&gt;Primeiro vou criar duas variáveis com os resultados dos dois métodos:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Método 1, criando novos campos no dataset com a transformação log (e)
first_method &amp;lt;- 
  df %&amp;gt;% 
  mutate(area_log = log(area),
         price_log = log(price)) %&amp;gt;% 
  lm(formula = area_log ~ price_log)

second_method &amp;lt;- 
  df %&amp;gt;% 
  lm(formula = log(area) ~ log(price))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Com as duas variáveis criadas, vamos criar uma tabela comparando os principais resultados dos modelos:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;data.frame(&amp;quot;1º Método&amp;quot; = c(first_method$coefficients),
           &amp;quot;2º Método&amp;quot; = c(second_method$coefficients))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##             X1º.Método X2º.Método
## (Intercept)  6.1113284  6.1113284
## price_log    0.9705823  0.9705823&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Conforme indicado, ambos os métodos geram o mesmo valor. Eu prefiro o segundo, que exige menos linhas de código. Com base nos coeficientes estimados, temos a seguinte equação:&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;math display&#34;&gt;\[\hat{Y} = 1.6416 + 0.9706X_1 + \mu\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;O resultado é estatisticamente significativo, visto que tanto o intercepto quanto a inclinação apresentam um valor-p baixo. Veja abaixo estes valores bem como o R².&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;second_method %&amp;gt;% summary()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Call:
## lm(formula = log(area) ~ log(price), data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.65076 -0.18823 -0.03096  0.24914  0.60492 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&amp;gt;|t|)    
## (Intercept)   6.1113     0.1686  36.254  &amp;lt; 2e-16 ***
## log(price)    0.9706     0.1106   8.773 5.03e-10 ***
## ---
## Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1
## 
## Residual standard error: 0.3088 on 32 degrees of freedom
## Multiple R-squared:  0.7063, Adjusted R-squared:  0.6972 
## F-statistic: 76.97 on 1 and 32 DF,  p-value: 5.031e-10&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Apesar destes dados mostrarem que a reta se ajustou bem aos dados e que o modelo consegue explicar ~70% da variação na variável dependente, é preciso anda analisar os resíduos para poder ter confiança no resultado para fazer projeções. No gráfico abaixo, vamos ver como se distribui os resíduos do modelo.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;model_residuals &amp;lt;- 
  data.frame(values = second_method$residuals)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Eu opto primeiro por analisar um histograma dos reísduos, pois ele indicará se a distribuição se assemelha a uma distribuição normal. Vamos ver isso no gráfico abaixo.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Histogram
model_residuals %&amp;gt;% 
  ggplot()+
  geom_histogram(mapping = aes(x = values), fill = &amp;quot;steel blue&amp;quot;)+
  theme_graph()+
  labs(title = &amp;quot;Distribuição dos Resíduos&amp;quot;,
       x = &amp;quot;&amp;quot;,
       y = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://francisco.piccolo.com/post/2019-09-05-residual-analysis-in-econometric-models/
index.en_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;432&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Aparentemente os resíduos se distribuem normalmente. Outro gráfico interessante para analisar é o &lt;strong&gt;q-q plot&lt;/strong&gt;, que também indicará quão parecido com a distribuição normal é a distribuição de uma variável.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# q-q plot
model_residuals %&amp;gt;% 
  ggplot()+
  geom_qq(mapping = aes(sample = values))+
  labs(title = &amp;quot;Residuals&amp;#39; Q-Q plot&amp;quot;,
       x = &amp;quot;&amp;quot;,
       y = &amp;quot;&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;https://francisco.piccolo.com/post/2019-09-05-residual-analysis-in-econometric-models/
index.en_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;432&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Este gráfico também aponta para a ideia de resíduos normalmente distribuídos. Apesar de estes métodos serem bons e práticos, as vezes é necessário usar métodos formais para gerar alguma conclusão. Para validação da independência no comportamento dos resíduos pode-se usar o teste &lt;strong&gt;Durbin Watson&lt;/strong&gt;. O código abaixo realiza este teste.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Necessário instalar e chamar o pacote &amp;#39;lmtest&amp;#39;
lmtest::dwtest(df %&amp;gt;% 
                 lm(formula = log(area) ~ log(price)))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
##  Durbin-Watson test
## 
## data:  df %&amp;gt;% lm(formula = log(area) ~ log(price))
## DW = 1.2912, p-value = 0.009801
## alternative hypothesis: true autocorrelation is greater than 0&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O resultado do teste foi de 1.2912, mas apenas com este valor não é possível fazer uma conclusão. Em conjunto com este valor, é preciso saber os valores limiares &lt;strong&gt;DL&lt;/strong&gt; e &lt;strong&gt;DU&lt;/strong&gt;, que podem ser encontrados nesta &lt;a href=&#34;http://www.portalaction.com.br/analise-de-regressao/33-diagnostico-de-independencia&#34;&gt;tabela&lt;/a&gt;. Para encontrar os valores com esta tabela, basta saber o número de observações no dataset (i.e. n = 33), o nível de significância do teste (i.e. 0.05) e os graus de liberdade (i.e. 1). Com isso, tem-se:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DL&lt;/strong&gt; = 1.35&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DU&lt;/strong&gt; = 1.49&lt;/p&gt;
&lt;p&gt;Tendo DW igual a 1.2912, acima de 0 e abaixo de DL, pode-se concluir que os resíduos são independentes.&lt;/p&gt;
&lt;p&gt;Com isso, podemos concluir que de fato o modelo é confiável para realizar projeções, pois tanto os gráficos quanto o teste formal indicam que as premissas (iii) e (iv) estão sendo atendidas, como como as outras premissas. Desta forma, podemos concluir que há elasticidade na oferta de cana de açúcar com relação ao seu preço.&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
