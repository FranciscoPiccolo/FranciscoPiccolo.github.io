---
title: "econometria"
output: html_document
---

### Exercício sobre autocorrelação de resíduos

Pacotes utilizados para execução das atividades
```{r,eval=T,include=T,echo=T,warning=F,message=F}
library(tidyverse)
library(lmtest)
library(corrplot)
library(readxl)
```

Objetivos: desenvolver gráficos para analisar autocorrelação de resíduos, aplicar o teste Durbin Watson, aplicar o teste Godfrey e aplicar o teste Q (a.k.a Ljung–Box test).

#### **Primeira parte**

Base de dados com valores do preço da cana de açucar e área plantada (em hectares), por período analisado. Deseja-se avaliar a elasticidade da área plantada com relação ao preço, a partir de uma série histórica. O modelo é descrito abaixo:

$$ lnY_t = \beta_1+\beta_2 (lnX_t) + U_t $$

Onde: 

$Y_t$ = área plantada no ano t (em hectares)

$X_t$ = preço no ano t

Base de dados para o exercício (apenas as primeiras 5 linhas):

```{r,eval=T,include=F,echo=F}
dados <- readxl::read_excel("C:/Users/francisco.piccolo/Downloads/04_Exercycio_Autocorrelayyo_Dados_Cana.xlsx")

dados %>% 
  mutate(
    periodo = Período,
    area = Área,
    valor = `Preço da Cana de Açúcar`
  ) -> dados_2 
```

```{r,eval=T,include=T,echo=F}
dados_2 %>%
  select(periodo,area,valor) %>% 
  head()
```

Gráfico de dispersão (área plantada x preço da cana)

```{r}
dados %>% 
  ggplot(aes(x=Área,y=`Preço da Cana de Açúcar`))+
  geom_point()
```

1. Verifique se há autocorrelação serial dos erros. Comente o diagrama de dispersão e o correlograma.

R: Primeiro, deve-se criar o modelo de regressão para depois gerar os erros. O modelo é resumido abaixo:

```{r,eval=T,include=T,echo=F}
lr <- lm(area~valor,data = dados_2)

summary(lr)

residual <- residuals(lr)
```

Abaixo há uma amostra dos resíduos gerados pelo modelo:

```{r,eval=T,include=F,echo=F}
df <- cbind(dados_2, residual)
```

```{r,eval=T,include=T,echo=F}
df %>% 
  select(periodo,area,valor,residual) %>% 
  head()
```

Após gerar os resíduos, pode-se analisar se há autocorrelação. Os gráficos abaixo mostram se há este comportamento.

```{r,eval=T,include=T,echo=F,warning=F,message=F,fig.align='center',fig.width=5,fig.height=3}
dados_2 %>% 
  ggplot(aes(x=periodo,y=residual,group=1))+
  geom_line()+
  geom_hline(lty=2,yintercept = 0,size=.2,color="red")+
  labs(
    title = "Resíduos ao longo dos períodos analisados",
    subtitle = "Não há correlação serial dos resíduos",
    x = "Período",
    y = "Valor dos resíduos"
  )
```

```{r,eval=T,include=T,echo=F,warning=F,message=F,fig.align='center',fig.width=5,fig.height=3}
dados_2 %>% 
  ggplot(aes(x=area,y=residual))+
  geom_point()+
  labs(
    title = "Diagrama de dispersão dos resíduos",
    subtitle = "Este gráfico também mostra que não há autocorrelação",
    x = "Área",
    y = "Resíduos"
  )
```

Dá para ver que não há autocorrelação entre os resíduos. Porém, para garantir, é interessante usar testes estatísticos formais, como o Durbin Watson ou Godfrey.

2. Aplique o teste de Durbin Watson, escrevendo as hipóteses e testando a autocorrelação. Use um nível de significância de 5%.

R: Abaixo há a aplicação do teste DW.

```{r,eval=T,include=T,echo=F,warning=F,message=F}
lmtest::dwtest(lr)
```

De maneira resumida, o valor-p foi de 0.04089 e o valor d, 1.91822. Neste teste, usa-se o valor d para gerar a conclusão do teste. Antes, é preciso trazer os intervalos para comparação deste valor d. Para encontrar o intervalor, use a [tablea](http://www.portalaction.com.br/analise-de-regressao/33-diagnostico-de-independencia) específica do teste.

De acordo com a tabela, sabendo a quantidade de registros (n = 33), a significância (0.05) e o nível de liberdade (degrees of freedom = 1) que é o número de variáveis independentes, pode-se achar os valores **dl** e **du**. Para este exercício tem-se:

**dl** = 1.35

**du** = 1.49

Sabendo que d = 1.91822 e os critérios do teste, pode-se concluir que a hipótese nula é verdadeira, ou seja, não existe autocorrelação. Isso corrobora os gráficos gerados anteriormente.

3. Aplique o teste Breusch Godfrey (a.k.a teste LM) escrevendo as hipóteses. Teste a autocorrelação com nível de significância de 5% e escreva a conclusão.

```{r}
lmtest::bgtest(lr)
```

O teste godfrey gerou um p valor de 0.1485

4. Aplique o teste Q e comente os resultados.

```{r}
Box.test(residual,lag = 1,type = c("Box-Pierce", "Ljung-Box"), fitdf = 0)
```










