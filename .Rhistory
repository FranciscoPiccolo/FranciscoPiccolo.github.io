dim()
dataset %>%
str()
dataset$DT_FIM_EXERC <- lubridate::ymd(dataset$DT_FIM_EXERC)
dataset
dataset %>% str()
dataset$DT_INI_EXERC <- lubridate::ymd(dataset$DT_INI_EXERC)
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
head()
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff) %>%
summarise(count = n()) %>%
ggplot2::ggplot()+
geom_col(mapping = aes(x = diff, y = count),
fill = "steel blue")+
scale_x_continuous(breaks = seq(0,10,by = 1))+
theme_graph()+
labs(title = "# Empresas por anos de dados disponibilizado",
subtitle = "Maioria das empreas com 9 anos de dados disponível",
x = "Anos em que a empresa possuí dados no dataset")
dataset %>%
distinct(CD_CONTA) %>%
dim()
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff) %>%
summarise(count = n()) %>%
head()
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
head()
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
head()
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
ggplot2::ggplot()+
geom_col(mapping = aes(x = CD_CONTA, y = count))+
coord_flip()
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
ggplot2::ggplot()+
geom_col(mapping = aes(x = CD_CONTA, y = count))+
coord_flip()+
facet_wrap(~count)
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
ggplot2::ggplot()+
geom_col(mapping = aes(x = CD_CONTA, y = count))+
coord_flip()+
facet_wrap(~count, nrow = 1)
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
ggplot2::ggplot()+
geom_col(mapping = aes(x = CD_CONTA, y = count))+
coord_flip()+
facet_grid(~count)
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
head()
blogdown:::preview_site(startup = TRUE)
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
mutate(total = sum(count)) %>%
head()
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
mutate(share = count/960) %>%
head()
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
mutate(share = count/960) %>%
dim()
dataset %>%
#filter(lubridate::year(DT_FIM_EXERC) != "2020") %>%
select(DENOM_CIA, CD_CONTA, DT_INI_EXERC, DT_FIM_EXERC) %>%
group_by(DENOM_CIA, CD_CONTA) %>%
summarise(first_year = lubridate::year(min(DT_INI_EXERC)),
last_year = lubridate::year(max(DT_FIM_EXERC))) %>%
mutate(diff = last_year-first_year) %>%
group_by(diff, CD_CONTA) %>%
summarise(count = n()) %>%
mutate(share = count/960) %>%
View()
library(tidyverse)
library(GetDFPData2)
dataset_original <- GetDFPData2::get_dfp_data(
first_year = "2010",
last_year = "2020",
type_docs = "DRE")
# Note a utilização do Encoding para preservar os acentos
write.csv(x = dataset_original$`DF Individual - Demonstração do Resultado`,
file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_2.csv",
fileEncoding = "latin1")
library(tidyverse)
library(GetDFPData2)
# Novamente, mantendo o encoding na hora da leitura
dataset <-
read.csv(file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_1.csv",
encoding = "latin1") %>%
```
dataset
dataset %>% dim()
# Novamente, mantendo o encoding na hora da leitura
dataset <-
read.csv(file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_2.csv",
encoding = "latin1") %>%
```
# Novamente, mantendo o encoding na hora da leitura
dataset <-
read.csv(file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_2.csv",
encoding = "latin1") %>%
```
# Novamente, mantendo o encoding na hora da leitura
dataset <-
read.csv(file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_2.csv",
encoding = "latin1") %>%
```
# Novamente, mantendo o encoding na hora da leitura
dataset <-
read.csv(file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_2.csv",
encoding = "latin1")
dataset %>%
dim()
# Tipos de dados
dataset %>%
str()
dataset %>%
mutate(DT_REFER = as.Date(DT_REFER)) -> teste
teste %>% str()
dataset %>%
mutate(DT_REFER = as.Date(DT_REFER),
DT_INI_EXERC = as.Date(DT_INI_EXERC),
DT_FIM_EXERC = as.Date(DT_FIM_EXERC)) -> dataset
dataset %>% str()
dataset %>%
head()
dataset %>%
select(-1) %>%  # retirando o primeiro campo da seleção
distinct_all() %>%
dim()
blogdown:::preview_site(startup = TRUE)
library(tidyverse)
library(GetDFPData2)
dataset_bp <- GetDFPData2::get_dfp_data(
first_year = "2010",
last_year = "2020",
type_docs = "BP")
dataset_bp <- GetDFPData2::get_dfp_data(
first_year = "2010",
last_year = "2020",
type_docs = "BPP")
write.csv(x = dataset_bp$`DF Individual - Balanço Patrimonial Passivo`,
file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_bpp_individual.csv",
fileEncoding = "latin1")
write.csv(x = dataset_bp$`DF Consolidado - Balanço Patrimonial Passivo`,
file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_bpp_consolidado.csv",
fileEncoding = "latin1")
write.csv(x = dataset_original$`DF Consolidado - Demonstração do Resultado`,
file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_dre_consolidado.csv",
fileEncoding = "latin1")
write.csv(x = dataset_bp$`DF Consolidado - Balanço Patrimonial Passivo`,
file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_bpp_consolidado_passivo.csv",
fileEncoding = "latin1")
write.csv(x = dataset_bp$`DF Consolidado - Balanço Patrimonial Ativo`,
file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_bpp_consolidado_ativo.csv",
fileEncoding = "latin1")
dataset_bpa <- GetDFPData2::get_dfp_data(
first_year = "2010",
last_year = "2020",
type_docs = "BPA")
write.csv(x = dataset_bpa$`DF Consolidado - Balanço Patrimonial Ativo`,
file = "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/dataset_bpp_consolidado_ativo.csv",
fileEncoding = "latin1")
file_path <- "C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io/datasets/2021-03-10-financial_dataset_b3_getdfpdata_package/"
# Novamente, mantendo o encoding na hora da leitura
dre <-
read.csv(file = paste(file_path,
"dataset_bpa_consolidado",
sep = ""),
encoding = "latin1")
# Novamente, mantendo o encoding na hora da leitura
dre <-
read.csv(file = paste(file_path,
"dataset_bpa_consolidado.csv",
sep = ""),
encoding = "latin1")
# Novamente, mantendo o encoding na hora da leitura
dre <-
read.csv(file = paste(file_path,
"dataset_dre_consolidado.csv",
sep = ""),
encoding = "latin1")
bpa <-
read.csv(file = paste(file_path,
"dataset_bpa_consolidado.csv",
sep = ""),
encoding = "latin1")
bpp <-
read.csv(file = paste(file_path,
"dataset_bpp_consolidado.csv",
sep = ""),
encoding = "latin1")
dre %>%
head()
dre %>%
dim()
bpa %>%
dim()
bpp %>%
dim()
# Os 3 datasets possuem o mesmo número de colunas
unified_dataset <- dre %>% union_all(bpa) %>% union_all(bpp)
unified_dataset %>% dim()
unified_dataset <-
dre %>%
mutate(source = "dre") %>%
union_all(bpa %>%
mutate(source = "bpa")) %>%
union_all(bpp %>%
mutate(source = "bpp"))
unified_dataset %>% dim()
unified_dataset %>% head()
unified_dataset_adj <-
unified_dataset %>%
select(CNPJ_CIA,
CD_CVM,
DT_REFER,
DENOM_CIA,
ESCALA_MOEDA,
CD_CONTA,
DS_CONTA,
VL_CONTA,
source) %>%
head()
unified_dataset %>%
select(CNPJ_CIA,
CD_CVM,
DT_REFER,
DENOM_CIA,
ESCALA_MOEDA,
CD_CONTA,
DS_CONTA,
VL_CONTA,
source) %>%
head()
unified_dataset_adj <-
unified_dataset %>%
select(CNPJ_CIA,
CD_CVM,
DT_REFER,
DENOM_CIA,
ESCALA_MOEDA,
CD_CONTA,
DS_CONTA,
VL_CONTA,
source) %>%
rename(cnpj = CNPJ_CIA,
cvm_code = CD_CVM,
reference_date = DT_REFER,
company_name = DENOM_CIA,
currency = ESCALA_MOEDA,
account_number = CD_CONTA,
account_description = DS_CONTA,
value = VL_CONTA) %>%
head()
unified_dataset %>%
select(CNPJ_CIA,
CD_CVM,
DT_REFER,
DENOM_CIA,
ESCALA_MOEDA,
CD_CONTA,
DS_CONTA,
VL_CONTA,
source) %>%
rename(cnpj = CNPJ_CIA,
cvm_code = CD_CVM,
reference_date = DT_REFER,
company_name = DENOM_CIA,
currency = ESCALA_MOEDA,
account_number = CD_CONTA,
account_description = DS_CONTA,
value = VL_CONTA) %>%
head()
unified_dataset_adj <-
unified_dataset %>%
select(CNPJ_CIA,
CD_CVM,
DT_REFER,
DENOM_CIA,
ESCALA_MOEDA,
CD_CONTA,
DS_CONTA,
VL_CONTA,
source) %>%
rename(cnpj = CNPJ_CIA,
cvm_code = CD_CVM,
reference_date = DT_REFER,
company_name = DENOM_CIA,
currency = ESCALA_MOEDA,
account_number = CD_CONTA,
account_description = DS_CONTA,
value = VL_CONTA)
# Números de registros e quantodade de colunas
unified_dataset_adj %>%
dim()
# Tipos de dados
dataset %>%
str()
# Tipos de dados
unified_dataset_adj %>%
str()
unified_dataset_adj %>%
mutate(reference_date == lubridate::ydm(unified_dataset_adj$reference_date)) -> unified_dataset_adj
unified_dataset_adj %>% str()
unified_dataset_adj
unified_dataset_adj %>%
head()
unified_dataset_adj$reference_date <- lubridate::ymd(unified_dataset_adj$reference_date)
unified_dataset_adj %>%
head()
unified_dataset_adj %>%
str()
# Conferindo se há duplicadas
unified_dataset_adj %>% dim()
# Salvando dataset após remoção das duplicadas
unified_dataset_adj %>%
distinct_all() %>%
dim()
unified_dataset_adj <-
unified_dataset_adj %>%
distinct_all()
unified_dataset_adj %>%
select(company_name) %>%
distinct_all() %>%
View()
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.") %>%
head()
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.") %>%
tidyr::spread("reference_date") %>%
head()
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.") %>%
tidyr::spread("reference_date","value") %>%
head()
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.") %>%
tidyr::spread("reference_date","value") %>%
View()
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.",
account_number %in% c("1","
1.01")) %>%
tidyr::spread("reference_date","value") %>%
head()
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.",
account_number %in% c("1","
1.01")) %>%
ggplot()+
geom_line(mapping = aes(x = reference_date, y = value))+
facet_wrap(~account_description)
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.",
account_number %in% c("1","1.01","2.01")) %>%
ggplot()+
geom_line(mapping = aes(x = reference_date, y = value))+
facet_wrap(~account_description)
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.",
account_number %in% c("1","1.01","2.01","3.01","3.03","3.04")) %>%
ggplot()+
geom_line(mapping = aes(x = reference_date, y = value))+
facet_wrap(~account_description)
# Os 3 datasets possuem o mesmo número de colunas
unified_dataset <-
dre %>%
mutate(source = "dre") %>%
union_all(bpa %>%
mutate(source = "bpa")) %>%
union_all(bpp %>%
mutate(source = "bpp"))
unified_dataset_adj <-
unified_dataset %>%
select(CNPJ_CIA,
CD_CVM,
DT_REFER,
DENOM_CIA,
ESCALA_MOEDA,
CD_CONTA,
DS_CONTA,
VL_CONTA,
source) %>%
rename(cnpj = CNPJ_CIA,
cvm_code = CD_CVM,
reference_date = DT_REFER,
company_name = DENOM_CIA,
currency = ESCALA_MOEDA,
account_number = CD_CONTA,
account_description = DS_CONTA,
value = VL_CONTA)
unified_dataset_adj$reference_date <- lubridate::ymd(unified_dataset_adj$reference_date)
# Conferindo se há duplicadas
unified_dataset_adj %>% dim()
unified_dataset_adj %>%
distinct_all() %>%
dim()
unified_dataset_adj <-
unified_dataset_adj %>%
distinct_all()
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.",
account_number %in% c("1","1.01","2.01","3.01","3.03","3.04")) %>%
ggplot()+
geom_line(mapping = aes(x = reference_date, y = value))+
facet_wrap(~account_description)
unified_dataset_adj %>%
filter(company_name == "VIA VAREJO S.A.") %>%
tidyr::spread("reference_date", "value") %>%
View()
setwd("C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io")
blogdown::serve_site()
