filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
ungroup() %>%
select(dow, "% Boleto") %>%
tidyr::spread(dow, `% Boleto`) %>%
kableExtra::kbl(format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("hold_position",
"scale_down")) %>%
kableExtra::footnote(general = "Sales betweem (D-60) and (D-5)")
q1 %>%
filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
ungroup() %>%
head()
q1 %>%
filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
ungroup() %>%
select(dow, "% Boleto") %>%
tidyr::spread(dow, `% Boleto`) %>%
head()
q1 %>%
filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
ungroup() %>%
arrange(calendar_day_of_week) %>%
select(dow, "% Boleto") %>%
tidyr::spread(dow, `% Boleto`) %>%
head()
q1 %>%
filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
arrange(calendar_day_of_week) %>%
ungroup() %>%
select(dow, "% Boleto") %>%
tidyr::spread(dow, `% Boleto`) %>%
head()
q1 %>%
filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
arrange(calendar_day_of_week) %>%
ungroup() %>%
select(dow, calendar_day_of_week, "% Boleto") %>%
tidyr::spread(dow, `% Boleto`) %>%
head()
tidyr::spread(dow, `% Boleto`) %>%
head()
tidyr::spread(dow, `% Boleto`) %>%
head()
tidyr::spread(dow, `% Boleto`) %>%
head()
q1 %>%
filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
ungroup() %>%
select(dow, calendar_day_of_week, "% Boleto") %>%
mutate(dow = fct_relevel(dow,
levels = c("mon","tue","wed","thu","fri","sat","sun"))) %>%
head()
q1 %>%
filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
ungroup() %>%
select(dow, calendar_day_of_week, "% Boleto") %>%
mutate(dow = fct_relevel(dow,
levels = c("mon","tue","wed","thu","fri","sat","sun"))) %>%
tidyr::spread(dow, `% Boleto`) %>%
head()
q1 %>%
filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
ungroup() %>%
select(dow, "% Boleto") %>%
mutate(dow = fct_relevel(dow,
levels = c("mon","tue","wed","thu","fri","sat","sun"))) %>%
tidyr::spread(dow, `% Boleto`) %>%
head()
q1 %>%
filter(order_datetime >= Sys.Date()-90) %>%
group_by(calendar_day_of_week, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
mutate("% Boleto" = scales::percent(Y/(Y+N),
accuracy = .01),
dow = case_when(calendar_day_of_week == 1 ~ "sun",
calendar_day_of_week == 2 ~ "mon",
calendar_day_of_week == 3 ~ "tue",
calendar_day_of_week == 4 ~ "wed",
calendar_day_of_week == 5 ~ "thu",
calendar_day_of_week == 6 ~ "fri",
TRUE ~ "sat"
)) %>%
ungroup() %>%
select(dow, "% Boleto") %>%
mutate(dow = fct_relevel(dow,
levels = c("mon","tue","wed","thu","fri","sat","sun"))) %>%
tidyr::spread(dow, `% Boleto`) %>%
kableExtra::kbl(format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("hold_position")) %>%
kableExtra::footnote(general = "Sales betweem (D-60) and (D-5)")
q1 %>%
mutate(month = lubridate::month(order_datetime)) %>%
group_by(reporting_year, month, is_paystation) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_paystation, quantity) %>%
rename("Other" = N, "Paystation" = Y) %>%
select(reporting_year,month, Other, Paystation) %>%
mutate("Paystation Rate" = scales::percent(Paystation/(Paystation+Other),
accuracy = .1)) %>%
select(reporting_year,month, "Paystation Rate") %>%
tidyr::spread(month,"Paystation Rate") %>%
kableExtra::kbl(linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("hold_position",
"scale_down")) %>%
column_spec(column = 1,
bold = F) %>%
add_header_above(c(" " = 1, "Months" = 12)) %>%
footnote(general = "Considering all sales (canceled and non canceled)")
q1 %>%
filter(is_paystation == "Y") %>%
group_by(order_datetime, is_canceled, calendar_day_of_week) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(is_canceled, quantity) %>%
group_by(calendar_day_of_week) %>%
mutate(roll_avg_N = zoo::rollmean(N, k = 7, na.pad = T, align = "right"),
roll_avg_Y = zoo::rollmean(Y, k = 7, na.pad = T, align = "right")) %>%
ungroup() %>%
mutate(cancel_rate_avg = roll_avg_Y/(roll_avg_Y+roll_avg_N),
cancel_rate = Y/(Y+N)) %>%
ggplot2::ggplot()+
geom_line(mapping = aes(x = order_datetime, y = cancel_rate),
alpha = .2,
color = "steel blue")+
geom_line(mapping = aes(x = order_datetime, y = cancel_rate_avg),
color = "dark orange")+
theme_graph()+
theme(axis.text.x = element_text(angle = 90))+
scale_y_continuous(labels = scales::percent)+
facet_grid(~calendar_day_of_week)+
labs(title = "Banking Billet Cancel Rate Over Time",
subtitle = "Segmented per Week Day (day of purchase)",
x = "",
y = "",
caption = "7 days rolling average")
q1 %>%
filter(is_paystation == "Y",
is_canceled == "N",
order_datetime >= Sys.Date()-60) %>%
group_by(reporting_year, reporting_week_of_year) %>%
summarise(quantity = sum(quantity)) %>%
ungroup() %>%
mutate("Year and Week" = paste(reporting_year,reporting_week_of_year,sep = "|")) %>%
select("Year and Week",quantity) %>%
tidyr::spread("Year and Week",quantity) %>%
kableExtra::kbl(caption = "Volume of Non Canceled Boletos per Week",
format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("HOLD_position",
"scale_down")) %>%
kableExtra::footnote(general = "Sales betweem (D-60) and (D-5)")
q1 %>%
filter(is_paystation == "Y",
is_canceled == "N",
order_datetime >= Sys.Date()-60) %>%
group_by(order_datetime) %>%
summarise(quantity = sum(quantity)) %>%
head()
q1 %>%
filter(is_paystation == "Y",
is_canceled == "N",
order_datetime >= Sys.Date()-10) %>%
group_by(order_datetime) %>%
summarise(quantity = sum(quantity)) %>%
tidyr::spread(order_datetime,quantity) %>%
kableExtra::kbl(caption = "Volume of Non Canceled Boletos per Purchase Day",
format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("HOLD_position",
"scale_down")) %>%
kableExtra::footnote(general = "Last 10 days of sales")
(27+34+36+31+21)/5
q1 %>%
filter(is_paystation == "Y",
is_canceled == "N") %>%
group_by(order_datetime) %>%
summarise(quantity = sum(quantity)) %>%
arrange(desc(order_datetime)) %>%
head(10) %>%
tidyr::spread(order_datetime,quantity) %>%
kableExtra::kbl(caption = "Volume of Non Canceled Boletos per Purchase Day",
format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("HOLD_position")) %>%
kableExtra::footnote(general = "10 days of sales")
q1 %>%
filter(is_paystation == "Y",
is_canceled == "N") %>%
group_by(order_datetime) %>%
summarise(quantity = sum(quantity)) %>%
arrange(desc(order_datetime)) %>%
head(10) %>%
tidyr::spread(order_datetime,quantity) %>%
head()
q1 %>%
filter(is_paystation == "Y",
is_canceled == "N") %>%
group_by(order_datetime) %>%
summarise(quantity = sum(quantity)) %>%
arrange(desc(order_datetime)) %>%
head(10) %>%
tidyr::spread(order_datetime,quantity) %>%
kableExtra::kbl(caption = "Volume of Non Canceled Boletos per Purchase Day",
format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("HOLD_position",
"scale_down")) %>%
kableExtra::footnote(general = "10 days of sales")
q2 <- readxl::read_excel(paste(dataset_path,"query_2.xlsx", sep = "/"))
q2 %>%
head()
q2 %>%
filter(is_customer_order_item_shipped == "N") %>%
group_by(is_customer_order_item_on_backlog) %>%
summarise(quantity = sum(quantity)) %>%
head()
q2 <- readxl::read_excel(paste(dataset_path,"query_2.xlsx", sep = "/"))
q2 %>%
filter(is_customer_order_item_shipped == "N") %>%
group_by(is_customer_order_item_on_backlog) %>%
summarise(quantity = sum(quantity)) %>%
head()
q2 %>%
group_by(is_customer_order_item_on_backlog) %>%
summarise(quantity = sum(quantity)) %>%
head()
q2 %>%
group_by(f2p_warehouse_decided_on_production) %>%
summarise(quantity = sum(quantity)) %>%
mutate(Share = scales::percent(quantity/sum(quantity),
accuracy = .1),
"Quantity Expected" = quantity*.25) %>%
rename("FC to Receive the Volume" = f2p_warehouse_decided_on_production,
"Quantity" = quantity) %>%
arrange(desc(Quantity)) %>%
kableExtra::kbl(format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("HOLD_position")) %>%
kableExtra::footnote(general = "Last 20 days of Sales",
number = "Quantity Expected using 25% of cancellation rate")
q2 %>%
head()
q2 %>%
filter(is_customer_order_item_on_backlog == "N") %>%
rename(FC = f2p_warehouse_decided_on_production) %>%
select(FC, quantity) %>%
head()
q2 %>%
filter(is_customer_order_item_on_backlog == "N") %>%
rename(FC = f2p_warehouse_decided_on_production) %>%
select(FC, quantity) %>%
kableExtra::kbl(caption = "Volume of Boletos Not in Backlog per FC",
format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("HOLD_position"))
q2 %>%
filter(is_customer_order_item_on_backlog == "N") %>%
rename(FC = f2p_warehouse_decided_on_production) %>%
select(FC, quantity) %>%
arrange(desc(quantity)) %>%
kableExtra::kbl(caption = "Volume of Boletos Not in Backlog per FC",
format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("HOLD_position"))
q2 %>%
filter(is_customer_order_item_on_backlog == "N") %>%
rename(FC = f2p_warehouse_decided_on_production) %>%
select(FC, quantity) %>%
mutate("%" = quantity/sum(quantity)) %>%
arrange(desc(quantity)) %>%
kableExtra::kbl(caption = "Volume of Boletos Not in Backlog per FC",
format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("HOLD_position"))
q2 %>%
filter(is_customer_order_item_on_backlog == "N") %>%
rename(FC = f2p_warehouse_decided_on_production) %>%
select(FC, quantity) %>%
mutate("%" = scales::percent(quantity/sum(quantity),
accuracy = .1)) %>%
arrange(desc(quantity)) %>%
kableExtra::kbl(caption = "Volume of Boletos Not in Backlog per FC",
format.args = list(big.mark = ".",
decimal.mark = ","),
linesep = "\\addlinespace") %>%
kable_styling(position = "center",
font_size = 8,
latex_options = c("HOLD_position"))
q3$order_datetime <- lubridate::ymd(q3$order_datetime)
q3 %>%
mutate(dow_2 = as.character(case_when(dow %in% c("sat","sun") ~ 1,
TRUE ~ 0))) %>%
ggplot2::ggplot()+
geom_col(mapping = aes(x = order_datetime, y = days_btw_purchase_and_backlog_entering, fill = dow_2), alpha = .7)+
scale_fill_manual(values = c("1" = "steel blue",
"0" = "dark orange"),
name = "Is Sat/Sun")+
theme_graph()+
facet_wrap(~f2p_warehouse_decided_on_production)+
labs(title = "Lead Time Between Purchase and Backlog Appearance",
subtitle = "Higher Lead Time on Weekends and Holidays (e.g. Carnaval)",
x = "",
y = "")
blogdown:::preview_site(startup = TRUE)
dataset <- readr::read_csv(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2021-02-27-dataset_economatica/economatica_dataset_original.csv")
dataset %>%
head()
library(tidyverse)
library(patchwork)
dataset %>%
head()
dataset
dataset <- readr::read_csv(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2021-02-27-dataset_economatica/economatica_dataset_original.csv")
blogdown::serve_site()
setwd("C:/Users/fppicco/Desktop/R/Github/franciscopiccolo.github.io")
blogdown::serve_site()
dataset <- readr::read_csv(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2021-02-27-dataset_economatica/economatica_dataset_original.csv")
dataset
dataset <- readr::read_csv(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2021-02-27-dataset_economatica/economatica_dataset_original.csv")
dataset
dataset <- readr::read_csv(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2021-02-27-dataset_economatica/economatica_dataset_original.csv",
delim = ";")
dataset <- readr::read_delim(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2021-02-27-dataset_economatica/economatica_dataset_original.csv",
delim = ";")
dataset
dataset %>% View()
dataset <- readr::read_delim(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2021-02-27-dataset_economatica/economatica_dataset_original.csv",
delim = ";")
dataset %>%
View()
blogdown::stop_server()
dataset <- readr::read_delim(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2021-02-27-dataset_economatica/economatica_dataset_original.csv",
delim = ";")
library(tidyverse)
library(patchwork)
# Função para padronizar o design dos gráficos
theme_graph <- function(){
theme(
plot.title = element_text(size = 14),
plot.subtitle = element_text(size = 10),
plot.caption = element_text(face = "italic", size = 8.5),
axis.text = element_text(size = 8.5),
axis.title = element_text(face = "italic", size = 8.5),
strip.background = element_rect(fill = "blue"),
strip.text = element_text(face = "bold"),
legend.position = "bottom",
legend.title = element_blank()
)
}
dataset %>%
head() %>%
knitr::kable(format.args = list(big.mark = ".", decimal.mark = "."))
blogdown::serve_site()
library(kableExtra)
blogdown::stop_server()
blogdown::serve_site()
dataset <- readr::read_delim(file = "https://raw.githubusercontent.com/FranciscoPiccolo/franciscopiccolo.github.io/master/datasets/2021-02-27-dataset_economatica/economatica_dataset_original.csv",
delim = ";")
dataset %>% View()
dataset %>%
head()
