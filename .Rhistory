query_19 %>%
ggplot()+
geom_line(mapping = aes(x = sale_date, y = avg_cancel_rate), color = graph_color, size = line_size)+
geom_hline(yintercept = .20, lty = 2, color = "dark orange")+
scale_y_continuous(labels = scales::percent)+
facet_wrap(~brand)+
labs(title = "Selected brands cancelation rate",
subtitle = "Only slipers with more than R$100.000 in GTV canceled on the past three years",
x = "",
y = "% GTV purchased by Slipers",
caption = "20 days moving average")
query_12$sale_date <- lubridate::ymd(query_12$sale_date)
query_12[sample(nrow(query_12),10), ]
query_12 %>%
mutate(share_blocked = round(items_qty/stock_quantity, digits = 4)) %>%
ggplot()+
geom_histogram(mapping = aes(x = share_blocked), fill = graph_color, binwidth = .05)+
scale_x_log10(labels = scales::percent)+
theme_graph()+
labs(title = "% of SKU quantity blocked by Sliper purchase",
x = "% stock blocked",
y = "SKUs")
query_12 %>%
mutate(share_blocked = round(items_qty/stock_quantity, digits = 4)) %>%
ggplot()+
geom_histogram(mapping = aes(x = share_blocked), fill = graph_color, binwidth = .05)+
scale_x_log10(labels = scales::percent)+
theme_graph()+
labs(title = "Slipers impact on SKU's inventory",
subtitle = "Same day impact",
x = "% stock blocked",
y = "SKUs")
query_12 %>%
mutate(share_blocked = round(items_qty/stock_quantity, digits = 4)) %>%
ggplot()+
geom_histogram(mapping = aes(x = share_blocked), fill = graph_color, binwidth = .05)+
scale_x_log10(labels = scales::percent)+
scale_y_continuous(labels = scales::comma)+
theme_graph()+
labs(title = "Slipers impact on SKU's inventory",
subtitle = "Same day impact",
x = "% stock blocked",
y = "SKUs")
query_16 %>%
ggplot()+
geom_line(mapping = aes(x = sale_date, y = gtv), color = graph_color, alpha = .4)+
geom_vline(xintercept = as.Date(c("2020-02-20")), lty = 2, color = "dark orange")+
scale_y_continuous(labels = scales::comma)+
facet_wrap(~customer_name, scales = "free_y")+
theme_graph()+
labs(title = "Customers that have received the contact",
x = "",
y = "GTV generated")
query_16$sale_date <- lubridate::ymd(query_16$sale_date)
query_16 %>%
ggplot()+
geom_line(mapping = aes(x = sale_date, y = gtv), color = graph_color, alpha = .4)+
geom_vline(xintercept = as.Date(c("2020-02-20")), lty = 2, color = "dark orange")+
scale_y_continuous(labels = scales::comma)+
facet_wrap(~customer_name, scales = "free_y")+
theme_graph()+
labs(title = "Customers that have received the contact",
x = "",
y = "GTV generated")
query_12 %>%
mutate(share_blocked = round(items_qty/stock_quantity, digits = 4)) %>%
ggplot()+
geom_histogram(mapping = aes(x = share_blocked), fill = graph_color, binwidth = .05)+
scale_x_log10(labels = scales::percent)+
scale_y_continuous(labels = scales::comma)+
theme_graph()+
labs(title = "Slipers impact on SKU's inventory",
subtitle = "Same day impact",
x = "% stock blocked",
y = "SKUs")
query_13 %>%
filter(sale_date >= Sys.Date()-365) %>%
mutate(sliper_type = fct_relevel(sliper_type, levels = c("light","medium","heavy","critical"))) %>%
distinct(customer_name, sliper_type) %>%
mutate(qty = 1) %>%
group_by(sliper_type) %>%
summarise(qty = sum(qty)) %>%
mutate("%_qty" = 100*(round(qty/sum(qty), digits = 4))) %>%
inner_join(gtv, by = c("sliper_type" = "sliper_type")) %>%
mutate(sliper_type = ifelse(sliper_type == "critical","critial (above 1.000.000)",
ifelse(sliper_type == "heavy","heavy (between 100.001 and 1.000.000)",
ifelse(sliper_type == "medium","medium (between 10.001 and 100.000",
ifelse(sliper_type == "light", "light (up to 10.000 of revenue generation",""))))) %>%
head()
install.packages("kableExtra")
kableExtra::kable(df)
df <- query_13 %>%
filter(sale_date >= Sys.Date()-365) %>%
mutate(sliper_type = fct_relevel(sliper_type, levels = c("light","medium","heavy","critical"))) %>%
distinct(customer_name, sliper_type) %>%
mutate(qty = 1) %>%
group_by(sliper_type) %>%
summarise(qty = sum(qty)) %>%
mutate("%_qty" = 100*(round(qty/sum(qty), digits = 4))) %>%
inner_join(gtv, by = c("sliper_type" = "sliper_type")) %>%
mutate(sliper_type = ifelse(sliper_type == "critical","critial (above 1.000.000)",
ifelse(sliper_type == "heavy","heavy (between 100.001 and 1.000.000)",
ifelse(sliper_type == "medium","medium (between 10.001 and 100.000",
ifelse(sliper_type == "light", "light (up to 10.000 of revenue generation","")))))
kableExtra::kable(df)
df <- query_13 %>%
filter(sale_date >= Sys.Date()-365) %>%
mutate(sliper_type = fct_relevel(sliper_type, levels = c("light","medium","heavy","critical"))) %>%
distinct(customer_name, sliper_type) %>%
mutate(qty = 1) %>%
group_by(sliper_type) %>%
summarise(qty = sum(qty)) %>%
mutate("%_qty" = 100*(round(qty/sum(qty), digits = 4))) %>%
inner_join(gtv, by = c("sliper_type" = "sliper_type")) %>%
mutate(sliper_type = ifelse(sliper_type == "critical","critial (above 1.000.000)",
ifelse(sliper_type == "heavy","heavy (between 100.001 and 1.000.000)",
ifelse(sliper_type == "medium","medium (between 10.001 and 100.000",
ifelse(sliper_type == "light", "light (up to 10.000 of revenue generation","")))))
kableExtra::kable(df)
knitr::kable(df)
knitr::kable(df)
df <- query_13 %>%
filter(sale_date >= Sys.Date()-365) %>%
mutate(sliper_type = fct_relevel(sliper_type, levels = c("light","medium","heavy","critical"))) %>%
distinct(customer_name, sliper_type) %>%
mutate(qty = 1) %>%
group_by(sliper_type) %>%
summarise(qty = sum(qty)) %>%
mutate("%_qty" = 100*(round(qty/sum(qty), digits = 4))) %>%
inner_join(gtv, by = c("sliper_type" = "sliper_type")) %>%
mutate(sliper_type = ifelse(sliper_type == "critical","critial (above 1.000.000)",
ifelse(sliper_type == "heavy","heavy (between 100.001 and 1.000.000)",
ifelse(sliper_type == "medium","medium (between 10.001 and 100.000",
ifelse(sliper_type == "light", "light (up to 10.000 of revenue generation","")))))
df
kable(df, "latex")
kable(df, "latex")
query_13$sale_date <- lubridate::ymd(query_13$sale_date)
query_13 %>%
filter(sale_date >= Sys.Date()-365) %>%
group_by(sliper_type) %>%
summarise(gtv = sum(gtv)) %>%
mutate("%_gtv" = 100*(round(gtv/sum(gtv), digits = 4))) %>%
select(sliper_type, "%_gtv") -> gtv
library(rJava)
library(RJDBC)
library(extrafont)
library(tidyverse)
library(gridExtra)
library(zoo)
library(knitr)
library(scales)
library(ggthemes)
library(kableExtra)
theme_graph <- function(){
theme(
plot.title = element_text(size = 10),
plot.subtitle = element_text(size = 6.5),
plot.caption = element_text(face = "italic", size = 6),
axis.text = element_text(size = 6),
axis.title = element_text(face = "italic", size = 6),
strip.background = element_rect(fill = "grey"),
strip.text = element_text(face = "bold"),
legend.title = element_blank(),
legend.position = "bottom",
legend.text = element_text(size = 5.5)
)
}
graph_color <- "#00AFA4"
graph_color_2 <- "#222222"
graph_color_3 <- "dark orange"
line_size <- .8
black_friday <- c("2019-11-29","2018-11-23","2017-11-24")
df <- query_13 %>%
filter(sale_date >= Sys.Date()-365) %>%
mutate(sliper_type = fct_relevel(sliper_type, levels = c("light","medium","heavy","critical"))) %>%
distinct(customer_name, sliper_type) %>%
mutate(qty = 1) %>%
group_by(sliper_type) %>%
summarise(qty = sum(qty)) %>%
mutate("%_qty" = 100*(round(qty/sum(qty), digits = 4))) %>%
inner_join(gtv, by = c("sliper_type" = "sliper_type")) %>%
mutate(sliper_type = ifelse(sliper_type == "critical","critial (above 1.000.000)",
ifelse(sliper_type == "heavy","heavy (between 100.001 and 1.000.000)",
ifelse(sliper_type == "medium","medium (between 10.001 and 100.000",
ifelse(sliper_type == "light", "light (up to 10.000 of revenue generation","")))))
kable(df, "latex")
kable(df)
tinytex::reinstall_tinytex()
sql_syntax <- readr::read_file("C:/Users/francisco.piccolo/Desktop/R/01.Analytics_Projects/nps_analysis_success_page_answer_rate/queries.sql")
library(rJava)
library(RJDBC)
library(tidyverse)
library(knitr)
library(scales)
theme_graph <- function(){
theme(
plot.title = element_text(size = 10),
plot.subtitle = element_text(size = 6.5),
plot.caption = element_text(face = "italic", size = 6),
axis.text = element_text(size = 6),
axis.title = element_text(face = "italic", size = 6),
strip.background = element_rect(fill = "grey"),
strip.text = element_text(face = "bold", size = 4.5),
legend.title = element_blank(),
legend.position = "bottom",
legend.text = element_text(size = 5.5)
)
}
graph_color <- "#00AFA4"
graph_color_2 <- "#222222"
graph_color_3 <- "dark orange"
line_size <- .8
black_friday <- c("2019-11-29","2018-11-23","2017-11-24")
dw_inf <- data.frame(read.table("C:/Users/francisco.piccolo/Desktop/R/Redshift_access/dw_prod_access.txt",sep = " "))
sprintf <- as.character(dw_inf[2,2])
host <- as.character(dw_inf[3,2])
port <- as.character(dw_inf[4,2])
dw <- as.character(dw_inf[5,2])
user <- as.character(dw_inf[6,2])
password <- as.character(dw_inf[7,2])
driver <- JDBC(driverClass = 'com.amazon.redshift.jdbc41.Driver', classPath = Sys.glob("C:/Users/francisco.piccolo/Documents/R/Redshift_JDBC/RedshiftJDBC41-1.1.9.1009.jar"), identifier.quote="`")
db_end <- sprintf(sprintf, host, port, dw)
jconn <- dbConnect(driver, db_end, user, password)
sql_syntax <- readr::read_file("C:/Users/francisco.piccolo/Desktop/R/01.Analytics_Projects/nps_analysis_success_page_answers_rate/queries.sql")
query_1 <- RJDBC::dbGetQuery(jconn,substr(sql_syntax,min(stringr::str_locate(string=sql_syntax,'-- query_1_begin')),max(stringr::str_locate(string=sql_syntax,'-- query_1_end'))))
readr::write_rds(query_1,"C:/Users/francisco.piccolo/Desktop/R/01.Analytics_Projects/nps_analysis_success_page_answers_rate/datasets/query_1.RDS")
query_1$sale_date <- lubridate::ymd(query_1$sale_date)
query_1 %>%
head()
query_1 %>%
ggplot()+
geom_line(mapping = aes(x = sale_date, y = answer_rate, group = country))
query_1 %>%
ggplot()+
geom_line(mapping = aes(x = sale_date, y = answer_rate, group = sotre))
query_1 %>%
ggplot()+
geom_line(mapping = aes(x = sale_date, y = answer_rate, group = store))
query_1 %>%
ggplot()+
geom_line(mapping = aes(x = sale_date, y = answer_rate, group = store, color = store))
query_1 %>%
filter(store %in% c("DAFITI BRAZIL","DAFITI ARGENTINA","DAFITI CHILE","DAFITI COLOMBIA")) %>%
ggplot()+
geom_line(mapping = aes(x = sale_date, y = answer_rate, group = store, color = store))
setwd(dir = "C:/Users/francisco.piccolo/Desktop/R/franciscopiccolo.github.io")
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
library(tidyverse)
library(DAAG)
library(Amelia)
library(ggthemes)
library(pander)
library(gridExtra)
library(grid)
library(plot3D)
theme_graph <- function(){
theme(
plot.title = element_text(size = 16),
plot.subtitle = element_text(size = 12),
plot.caption = element_text(face = "italic", size = 9),
axis.text = element_text(size = 9),
axis.title = element_text(face = "italic", size = 9),
text = element_text(family = "Times New Roman"),
strip.background = element_rect(fill = "grey"),
strip.text = element_text(face = "bold"),
legend.title = element_blank(),
legend.position = "bottom"
)
}
graph_color <- "#006666"
# Caminho para a pasta que contém os data sets para cada exercício
path <- "C:/Users/francisco.piccolo/Desktop/R/franciscopiccolo.github.io/base_de_dados/livro-econometria-basica-gujarati/"
tbl_1.3 <- read.table(file = paste(path,"tabela_1.3_IPC.txt",
sep = ""),
sep = " ",
header = T,
dec = ",")
# Random sample of the dataset
tbl_1.3[sample(nrow(tbl_1.3),10), ] %>% pander::pander()
# Inflation rate (1985 = 100)
cpi_index <- tbl_1.3 %>%
filter(year %in% c(1985,2005))
pci_index <- cpi_index[2,2:8]-pci_index[1,2:8]
knitr::kable(ipc_index, align = "c")
cpi_index <- cpi_index[2,2:8]-cpi_index[1,2:8]
knitr::kable(cpi_index, align = "c")
tbl_1.3 %>%
tidyr::gather("campo", "valor", 2:8) %>%
ggplot(aes(x = year, y = valor, group = campo, color = campo))+
geom_line()+
theme_graph()+
labs(title = "Anual inflation for selected countries",
x = "",
y = "")
tbl_1.4 <- read.table(file = paste(path,"tabela_1.4_cambio.txt",sep = ""),
sep = " ",
header = T,
dec = ",",
)
# Ajustando a coluna do reino unido (1/taxa)
tbl_1.4 <-
tbl_1.4 %>%
mutate(Reino.unido = 1/Reino.unido)
# Amostra aleatório de 10 valores da tabela
tbl_1.4[sample(nrow(tbl_1.4),10), ]
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
filter(campo != "Coreia.sul",
campo != "Japao",
campo != "Suica",
campo != "Reino.unido",
campo != "Canada",
campo != "Australia"
) %>%
mutate(campo = fct_relevel(campo, levels = c("Mexico", "China", "Suecia"))) %>%
ggplot(aes(x = Ano, y = valor,group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
filter(campo %in% c("Coreia.sul","Japao")) %>%
ggplot(aes(x = Ano, y = valor, group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
filter(campo %in% c("Reino.unido","Canada","Australia","Suica")) %>%
mutate(campo = fct_relevel(campo, levels = c("Suica", "Canada", "Australia", "Reino.unido"))) %>%
ggplot(aes(x = Ano, y = valor, group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
filter(campo != "Coreia.sul",
campo != "Japao",
campo != "Suica",
campo != "Reino.unido",
campo != "Canada",
campo != "Australia"
) %>%
mutate(campo = fct_relevel(campo, levels = c("Mexico", "China", "Suecia"))) %>%
ggplot(aes(x = Ano, y = valor,group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
filter(campo %in% c("Coreia.sul","Japao")) %>%
ggplot(aes(x = Ano, y = valor, group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
filter(campo %in% c("Reino.unido","Canada","Australia","Suica")) %>%
mutate(campo = fct_relevel(campo, levels = c("Suica", "Canada", "Australia", "Reino.unido"))) %>%
ggplot(aes(x = Ano, y = valor, group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
mutate(campo = fct_relevel(campo, levels = c("Mexico", "China", "Suecia"))) %>%
ggplot(aes(x = Ano, y = valor,group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
filter(campo != "Coreia.sul",
campo != "Japao",
campo != "Suica",
campo != "Reino.unido",
campo != "Canada",
campo != "Australia"
) %>%
mutate(campo = fct_relevel(campo, levels = c("Mexico", "China", "Suecia"))) %>%
ggplot(aes(x = Ano, y = valor,group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
filter(campo %in% c("Coreia.sul","Japao")) %>%
ggplot(aes(x = Ano, y = valor, group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.4 %>%
tidyr::gather("campo","valor",2:10) %>%
filter(campo %in% c("Reino.unido","Canada","Australia","Suica")) %>%
mutate(campo = fct_relevel(campo, levels = c("Suica", "Canada", "Australia", "Reino.unido"))) %>%
ggplot(aes(x = Ano, y = valor, group = campo, color = campo))+
geom_line(size = 1.2)+
theme_graph()+
labs(title = "Exchange rate times serie",
x = "",
y = "Currency per 1 US$")
tbl_1.6 <- read.table(file = paste(path,"tabela_1.6_publicidade.txt",sep = ""),
sep = " ",
header = T,
dec = ","
)
# Amostra aleatória dos dados
tbl_1.6[sample(nrow(tbl_1.6),10), ]
tbl_1.6 <- read.table(file = paste(path,"tabela_1.6_publicidade.txt",sep = ""),
sep = " ",
header = T,
dec = ","
)
# Amostra aleatória dos dados
tbl_1.6[sample(nrow(tbl_1.6),10), ]
tbl_1.6 %>%
ggplot(aes(x = investment, y = impressions))+
geom_point(color = graph_color)+
geom_smooth(method = "lm", formula = y ~ x, se = F, lty = 20, color = "dark orange")+
theme_graph()+
labs(title = "Investment and Impressions relation",
x = "Investmnet",
y = "Impressions")
tbl_2.7 <- read.table(file = paste(path,"tabela_2.7_labour_market.txt",sep = ""),
sep = " ",
header = T,
dec = ","
)
# Amostra dos dados
tbl_2.7[sample(nrow(tbl_2.7),10), ]
women_df <-
tbl_2.7 %>%
select(share_women_work_force,unemployment_women) %>%
transmute(
share_work_force = share_women_work_force,
unemployment = unemployment_women
) %>%
mutate(type = "women")
tbl_2.7 %>%
select(share_men_work_force,unemployment_men) %>%
transmute(
share_work_force = share_men_work_force,
unemployment = unemployment_men
) %>%
mutate(type = "men") %>%
ggplot(aes(x=share_work_force,y=unemployment,color=type))+
geom_point(color = graph_color)+
theme_graph()+
labs(title = "Men's unemployment and participation rate",
x = "Participation rate (%)",
y = "Unemployment rate (%)")
women_df <-
tbl_2.7 %>%
select(share_women_work_force,avg_hourly_earning_women) %>%
transmute(
share_work_force = share_women_work_force,
avg_hourly_earning = avg_hourly_earning_women
) %>%
mutate(type = "women")
tbl_2.7 %>%
select(share_men_work_force,avg_hourly_earning_men) %>%
transmute(
share_work_force = share_men_work_force,
avg_hourly_earning = avg_hourly_earning_men
) %>%
mutate(type = "men") %>%
union_all(women_df) %>%
ggplot(aes(x=share_work_force,y=avg_hourly_earning,color=type))+
geom_point()+
theme_graph()+
labs(title = "Average hourly wage and participation rate",
x = "Participation rate",
y = "Hourly wage")
tbl_2.7 %>%
select(share_men_work_force,avg_hourly_earning_men) %>%
transmute(
share_work_force = share_men_work_force,
avg_hourly_earning = avg_hourly_earning_men
) %>%
mutate(type = "men") %>%
union_all(women_df) %>%
ggplot(aes(x=share_work_force,y=avg_hourly_earning,color=type))+
geom_point()+
scale_color_brewer(type = "qual")+
theme_graph()+
labs(title = "Average hourly wage and participation rate",
x = "Participation rate",
y = "Hourly wage")
